from django.http import JsonResponse
import time
from django.views.decorators.http import require_http_methods
import json


@require_http_methods(["POST"])
def process_request(request):
    try:
        # è§£æ JSON æ•°æ®
        data = json.loads(request.body)
        delay = float(data.get('delay', 60))

        # å‚æ•°éªŒè¯
        if not (0 <= delay <= 60):
            return JsonResponse(
                {"status": "error", "message": "Delay 0-60 seconds"},
                status=400
            )

        # æ¨¡æ‹Ÿå¤„ç†å»¶æ—¶
        time.sleep(delay)

        # æˆåŠŸå“åº”
        return JsonResponse({
            "status": "completed",
            "delay_seconds": delay,
            "result": f"Processed after {delay}s"
        })

    except (json.JSONDecodeError, ValueError):
        return JsonResponse(
            {"status": "error", "message": "Invalid JSON format"},
            status=400
        )

s = {
    "message": "{\n   \"campaignData\": {\n     \"stage\": \"è€ƒè™‘é˜¶æ®µ(Consideration)æˆ–æ„å‘é˜¶æ®µ(Intent)\",\n     \"objectives\": \"ç¡®ç«‹å“ç‰Œçš„ä»·å€¼è§‚å’Œç‹¬ç‰¹å–ç‚¹ï¼Œå¸å¼•å—ä¼—çš„å…´è¶£å¹¶å¼•å¯¼ä»–ä»¬è€ƒè™‘äº§å“æˆ–æœåŠ¡çš„å®ç”¨æ€§å’Œæ•ˆç›Šã€‚\"\n   },\n   \"personaData\": {\n     \"desc\": \"ç›®æ ‡å—ä¼—å¯èƒ½æ˜¯å°åˆ›ä¸šä¸»ã€å°å“ç‰Œä¸»æˆ–ä¸€çº¿è¥é”€äººå‘˜ï¼Œåœ¨æœ‰é™çš„é¢„ç®—ä¸‹ï¼Œå¯»æ‰¾æœ‰æ•ˆçš„è¥é”€ç­–ç•¥ã€‚\",\n     \"motives\": \"å¯¹é«˜æ•ˆç²¾å‡†çš„è¥é”€æ–¹æ³•çš„è¿½æ±‚ï¼›å¯¹å“ç‰Œä»·å€¼è§‚çš„è®¤åŒï¼›å¸Œæœ›åœ¨ç«äº‰æ¿€çƒˆçš„å¸‚åœºä¸­è·å¾—ä¼˜åŠ¿ã€‚\"\n   },\n   \"productData\": {\n     \"name\": \"æ­¤å¤„ä¸ºå‡è®¾äº§å“åï¼Œå¦‚ â€œæ­¥æ­¥ä¸ºè¥è¥é”€ç­–ç•¥â€\",\n     \"usp\": \"åŸºäºè¥é”€æ¼æ–—çš„ç²¾å‡†è¥é”€æ•ˆæœå’Œæ­¥æ­¥ä¸ºè¥çš„æœåŠ¡ç†å¿µ\",\n     \"brandValues\": \"æ•ˆæœè‡³ä¸Š\"\n   },\n   \"senarioData\": {\n     \"places\": \"é€‚åˆåœ¨çº¿ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œå¦‚å¾®ä¿¡ç¾¤ã€ç¤¾äº¤åª’ä½“ã€å…¬å¸å®˜ç½‘ç­‰ï¼Œä½¿ç”¨å®æ—¶äº’åŠ¨çš„æ–¹å¼åˆ†äº«è¥é”€çŸ¥è¯†ã€‚\",\n     \"emotionTags\": [\"æ¿€åŠ±(Inspirational)\", \"ä¿¡ä»»(Trust)\", \"å…±èµ¢(Win-Win)\"]\n   },\n   \"advicesData\": [\n     {\n       \"issue\": \"æ–‡æ¡ˆä¸­çš„'ğŸ”¥ **è®©æˆ‘ä»¬ç»™ä½ çš„äº‹ä¸š** _æ­¥æ­¥ä¸ºè¥_ **çš„ç­–ç•¥ä¸æ•ˆæœï¼_'æœªæ˜ç¡®è¡¨è¾¾äº§å“æˆ–æœåŠ¡çš„å…·ä½“åç§°ã€‚\",\n       \"suggestion\": \"å»ºè®®å°† 'æ­¥æ­¥ä¸ºè¥çš„ç­–ç•¥ä¸æ•ˆæœ' æ›´æ¢ä¸ºå…·ä½“çš„æœåŠ¡æˆ–äº§å“åç§°ï¼Œä»¥æé«˜å“ç‰Œè¯†åˆ«åº¦å’Œæ¸…æ™°åº¦ã€‚\"\n     },\n     {\n       \"issue\": \"å“ç‰Œä»·å€¼è§‚è™½ç„¶æåˆ°ï¼Œä½†æœªå…·ä½“å±•å¼€ã€‚\",\n       \"suggestion\": \"è¯¦ç»†é˜è¿°å“ç‰Œä»·å€¼è§‚å¦‚ã€Šæ•ˆæœè‡³ä¸Šã€‹å…·ä½“å¦‚ä½•ä½“ç°åœ¨äº§å“å’ŒæœåŠ¡ä¸Šï¼Œä»¥ä¾¿å—ä¼—ç†è§£å…¶é‡è¦æ€§ã€‚\"\n     },\n     {\n       \"issue\": \"äº§å“ç‹¬ç‰¹å–ç‚¹ 'æ³¨é‡è¥é”€æ•ˆæœ' å¹¶æœªè¯¦ç»†è§£æï¼Œ',\n       \"suggestion\": \"å»ºè®®ä½¿ç”¨å…·ä½“æ¡ˆä¾‹æˆ–æ•°æ®æ¥å±•ç¤ºç‹¬ç‰¹å–ç‚¹ï¼Œå¢å¼ºè¯´æœåŠ›ã€‚\"\n     },\n     {\n       \"issue\": \"å¾®ä¿¡ç¾¤è¢«æåŠä¸ºäº¤æµæ¸ é“ï¼Œä½†æ²¡æœ‰æ˜ç¡®å…¶åœ¨æ•´ä¸ªè¥é”€ç­–ç•¥ä¸­çš„ä½œç”¨ã€‚\",\n       \"suggestion\": \"åº”è¯¥è¿›ä¸€æ­¥é˜è¿°å¾®ä¿¡ç¾¤å°†å¦‚ä½•å¸®åŠ©å—ä¼—å®ç°ã€Šæ­¥æ­¥ä¸ºè¥ã€‹çš„å“ç‰Œæ‰¿è¯ºï¼Œä»¥åŠå¦‚ä½•åœ¨ç¾¤å†…å¼€å±•è¥é”€æ´»åŠ¨ã€‚\"\n     },\n     {\n       \"issue\": \"æ–‡æ¡ˆæœ«å°¾çªç„¶æ–­å¼€ï¼Œæ²¡æœ‰ç»™å‡ºå®Œæ•´çš„è¡ŒåŠ¨å‘¼åã€‚\",\n       \"suggestion\": \"åœ¨æ–‡æ¡ˆæœ«å°¾æ·»åŠ æ˜ç¡®çš„è¡ŒåŠ¨å‘¼åï¼Œå¦‚ 'ç«‹å³åŠ å…¥æˆ‘ä»¬çš„å¾®ä¿¡ç¾¤ï¼Œå¼€å¯ä½ çš„è¥é”€æˆåŠŸä¹‹æ—…ï¼'\"\n     }\n   ]\n}"
}

