{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { NTabs, NTabPane } from 'naive-ui';\nimport { ref } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport RegisterForm from './RegisterForm.vue';\nimport LoginForm from './LoginForm.vue';\n\n//通用变量\n\nexport default {\n  __name: 'LoginRegister',\n  setup(__props, {\n    expose: __expose\n  }) {\n    const authStore = useStore();\n    const router = useRouter();\n\n    //登录表单操作\n    const loginUsername = ref('');\n    const loginPassword = ref('');\n    const keepLoggedInForDays = ref('7'); // 默认设置为7天，通过select控件让用户可选择\n\n    const login = async () => {\n      try {\n        const response = await axios.post('/account/login/', {\n          username: loginUsername.value,\n          password: loginPassword.value,\n          keep_logged_in_for_days: keepLoggedInForDays.value\n        }, {\n          withCredentials: true,\n          headers: {\n            //先注销'X-CSRFToken': csrfToken.value,\n          }\n        });\n        const token = response.data.token.access;\n        const user = response.data.username;\n        const csrf_token = response.data.csrf_token;\n        console.log('csrf_token:', csrf_token);\n        localStorage.setItem('token', token);\n        await authStore.commit('auth_success', {\n          token,\n          user\n        });\n        console.log(\"登录成功：\", loginUsername.value);\n        await router.push('/dashboard');\n      } catch (err) {\n        console.log(\"登录失败：\", err);\n      }\n    };\n\n    //暴露方法\n    __expose({\n      login\n    });\n    const __returned__ = {\n      authStore,\n      router,\n      loginUsername,\n      loginPassword,\n      keepLoggedInForDays,\n      login,\n      get NTabs() {\n        return NTabs;\n      },\n      get NTabPane() {\n        return NTabPane;\n      },\n      ref,\n      get useStore() {\n        return useStore;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get axios() {\n        return axios;\n      },\n      RegisterForm,\n      LoginForm\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["NTabs","NTabPane","ref","useStore","useRouter","axios","RegisterForm","LoginForm","authStore","router","loginUsername","loginPassword","keepLoggedInForDays","login","response","post","username","value","password","keep_logged_in_for_days","withCredentials","headers","token","data","access","user","csrf_token","console","log","localStorage","setItem","commit","push","err","__expose"],"sources":["/Users/wangjohnson/ai_marketing/frontend/src/components/LoginRegister.vue"],"sourcesContent":["<template>\n\n    <n-tabs\n      class=\"card-tabs\"\n      default-value=\"login\"\n      size=\"large\"\n      animated\n      pane-wrapper-style=\"margin: 0 -4px\"\n      pane-style=\"padding-left: 4px; padding-right: 4px; box-sizing: border-box;\"\n    >\n\n      <n-tab-pane name=\"login\" tab=\"登录\">\n            <login-form/>\n       <!--\n        <n-form>\n          <n-form-item-row label=\"用户名\">\n            <n-input v-model:value=\"loginUsername\" placeholder=\"\"/>\n          </n-form-item-row>\n          <n-form-item-row label=\"密码\">\n            <n-input v-model:value=\"loginPassword\" placeholder=\"\" type=\"password\" show-password-on=\"click\" :maxlength=\"15\"/>\n          </n-form-item-row>\n        </n-form>\n        <n-button @click=\"login\" type=\"primary\" block secondary strong>\n          登录\n        </n-button>\n        -->\n      </n-tab-pane>\n\n      <n-tab-pane name=\"register\" tab=\"注册\">\n        <register-form/>\n        \n\n        <!--\n        <n-form>\n          <n-form-item-row label=\"用户名\">\n            <n-input v-model:value=\"registerUsername\" placeholder=\"\" />\n          </n-form-item-row>\n          <n-form-item-row label=\"密码\">\n            <n-input v-model:value=\"registerPassword\" placeholder=\"\"/>\n          </n-form-item-row>\n          <n-form-item-row label=\"重复密码\">\n            <n-input v-model:value=\"registerRePassword\" placeholder=\"\"/>\n          </n-form-item-row>\n          <n-form-item-row label=\"邀请码\">\n            <n-input v-model:value=\"invitation_code\" placeholder=\"\"/>\n          </n-form-item-row>\n        </n-form>\n        <n-button @click=\"register\" type=\"primary\" block secondary strong>\n          注册\n        </n-button>\n        -->\n      </n-tab-pane>\n    </n-tabs>\n \n</template>\n\n<script setup>\nimport {NTabs,NTabPane} from 'naive-ui'\nimport {ref,defineExpose} from 'vue';\nimport {useStore} from 'vuex';\nimport {useRouter} from 'vue-router';\nimport axios from 'axios';\nimport RegisterForm from './RegisterForm.vue';\nimport LoginForm from './LoginForm.vue';\n\n\n//通用变量\nconst authStore = useStore();\nconst router = useRouter();\n\n//登录表单操作\nconst loginUsername = ref('');\nconst loginPassword = ref('');\nconst keepLoggedInForDays = ref('7'); // 默认设置为7天，通过select控件让用户可选择\n\nconst login = async () => {\n    try{\n        const response = await axios.post('/account/login/', \n        {   \n          username: loginUsername.value,\n          password: loginPassword.value,\n          keep_logged_in_for_days: keepLoggedInForDays.value\n        },  \n        {   \n          withCredentials: true,\n          headers: {\n            //先注销'X-CSRFToken': csrfToken.value,\n          }   \n        });\n        const token = response.data.token.access;\n        const user = response.data.username;\n        const csrf_token = response.data.csrf_token;\n        console.log('csrf_token:',csrf_token);\n        localStorage.setItem('token', token);\n        await authStore.commit('auth_success', { token, user });\n        console.log(\"登录成功：\",loginUsername.value); \n        await router.push('/dashboard');\n        \n        }catch(err){\n            console.log(\"登录失败：\",err)\n        }\n    }\n\n\n\n//暴露方法\ndefineExpose({login});\n</script>\n\n<style>\n.n-input{\n    text-align:left}\n</style>\n\n"],"mappings":";AAyDA,SAAQA,KAAK,EAACC,QAAQ,QAAO,UAAU;AACvC,SAAQC,GAAgB,QAAO,KAAK;AACpC,SAAQC,QAAQ,QAAO,MAAM;AAC7B,SAAQC,SAAS,QAAO,YAAY;AACpC,OAAOC,KAAK,MAAM,OAAO;AACzB,OAAOC,YAAY,MAAM,oBAAoB;AAC7C,OAAOC,SAAS,MAAM,iBAAiB;;AAGvC;;;;;;;IACA,MAAMC,SAAS,GAAGL,QAAQ,CAAC,CAAC;IAC5B,MAAMM,MAAM,GAAGL,SAAS,CAAC,CAAC;;IAE1B;IACA,MAAMM,aAAa,GAAGR,GAAG,CAAC,EAAE,CAAC;IAC7B,MAAMS,aAAa,GAAGT,GAAG,CAAC,EAAE,CAAC;IAC7B,MAAMU,mBAAmB,GAAGV,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;;IAEtC,MAAMW,KAAK,GAAG,MAAAA,CAAA,KAAY;MACtB,IAAG;QACC,MAAMC,QAAQ,GAAG,MAAMT,KAAK,CAACU,IAAI,CAAC,iBAAiB,EACnD;UACEC,QAAQ,EAAEN,aAAa,CAACO,KAAK;UAC7BC,QAAQ,EAAEP,aAAa,CAACM,KAAK;UAC7BE,uBAAuB,EAAEP,mBAAmB,CAACK;QAC/C,CAAC,EACD;UACEG,eAAe,EAAE,IAAI;UACrBC,OAAO,EAAE;YACP;UAAA;QAEJ,CAAC,CAAC;QACF,MAAMC,KAAK,GAAGR,QAAQ,CAACS,IAAI,CAACD,KAAK,CAACE,MAAM;QACxC,MAAMC,IAAI,GAAGX,QAAQ,CAACS,IAAI,CAACP,QAAQ;QACnC,MAAMU,UAAU,GAAGZ,QAAQ,CAACS,IAAI,CAACG,UAAU;QAC3CC,OAAO,CAACC,GAAG,CAAC,aAAa,EAACF,UAAU,CAAC;QACrCG,YAAY,CAACC,OAAO,CAAC,OAAO,EAAER,KAAK,CAAC;QACpC,MAAMd,SAAS,CAACuB,MAAM,CAAC,cAAc,EAAE;UAAET,KAAK;UAAEG;QAAK,CAAC,CAAC;QACvDE,OAAO,CAACC,GAAG,CAAC,OAAO,EAAClB,aAAa,CAACO,KAAK,CAAC;QACxC,MAAMR,MAAM,CAACuB,IAAI,CAAC,YAAY,CAAC;MAE/B,CAAC,QAAMC,GAAG,EAAC;QACPN,OAAO,CAACC,GAAG,CAAC,OAAO,EAACK,GAAG,CAAC;MAC5B;IACJ,CAAC;;IAIL;IACAC,QAAY,CAAC;MAACrB;IAAK,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}