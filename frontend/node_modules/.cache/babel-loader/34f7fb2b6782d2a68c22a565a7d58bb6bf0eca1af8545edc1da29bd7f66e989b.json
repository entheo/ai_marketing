{"ast":null,"code":"import { h, defineComponent, Fragment, ref, withDirectives, Transition, vShow, watch, computed, toRef, onBeforeUnmount, inject, normalizeStyle } from 'vue';\nimport { zindexable } from 'vdirs';\nimport { useIsMounted } from 'vooks';\nimport { LazyTeleport } from 'vueuc';\nimport { on, off } from 'evtd';\nimport { beforeNextFrameOnce } from 'seemly';\nimport { kebabCase } from 'lodash-es';\nimport { RotateClockwiseIcon, RotateCounterclockwiseIcon, ZoomInIcon, ZoomOutIcon, ResizeSmallIcon, DownloadIcon } from \"../../_internal/icons/index.mjs\";\nimport { useConfig, useLocale, useTheme, useThemeClass } from \"../../_mixins/index.mjs\";\nimport { NBaseIcon } from \"../../_internal/index.mjs\";\nimport { download } from \"../../_utils/index.mjs\";\nimport { NTooltip } from \"../../tooltip/index.mjs\";\nimport { imageLight } from \"../styles/index.mjs\";\nimport { prevIcon, nextIcon, closeIcon } from \"./icons.mjs\";\nimport { imageContextKey, imagePreviewSharedProps } from \"./interface.mjs\";\nimport style from \"./styles/index.cssr.mjs\";\nconst BLEEDING = 32;\nexport default defineComponent({\n  name: 'ImagePreview',\n  props: Object.assign(Object.assign({}, imagePreviewSharedProps), {\n    onNext: Function,\n    onPrev: Function,\n    clsPrefix: {\n      type: String,\n      required: true\n    }\n  }),\n  setup(props) {\n    const themeRef = useTheme('Image', '-image', style, imageLight, props, toRef(props, 'clsPrefix'));\n    let thumbnailEl = null;\n    const previewRef = ref(null);\n    const previewWrapperRef = ref(null);\n    const previewSrcRef = ref(undefined);\n    const showRef = ref(false);\n    const displayedRef = ref(false);\n    const {\n      localeRef\n    } = useLocale('Image');\n    function syncTransformOrigin() {\n      const {\n        value: previewWrapper\n      } = previewWrapperRef;\n      if (!thumbnailEl || !previewWrapper) return;\n      const {\n        style\n      } = previewWrapper;\n      const tbox = thumbnailEl.getBoundingClientRect();\n      const tx = tbox.left + tbox.width / 2;\n      const ty = tbox.top + tbox.height / 2;\n      style.transformOrigin = `${tx}px ${ty}px`;\n    }\n    function handleKeydown(e) {\n      var _a, _b;\n      switch (e.key) {\n        case ' ':\n          e.preventDefault();\n          break;\n        case 'ArrowLeft':\n          (_a = props.onPrev) === null || _a === void 0 ? void 0 : _a.call(props);\n          break;\n        case 'ArrowRight':\n          (_b = props.onNext) === null || _b === void 0 ? void 0 : _b.call(props);\n          break;\n        case 'Escape':\n          toggleShow();\n          break;\n      }\n    }\n    watch(showRef, value => {\n      if (value) {\n        on('keydown', document, handleKeydown);\n      } else off('keydown', document, handleKeydown);\n    });\n    onBeforeUnmount(() => {\n      off('keydown', document, handleKeydown);\n    });\n    let startX = 0;\n    let startY = 0;\n    let offsetX = 0;\n    let offsetY = 0;\n    let startOffsetX = 0;\n    let startOffsetY = 0;\n    let mouseDownClientX = 0;\n    let mouseDownClientY = 0;\n    let dragging = false;\n    function handleMouseMove(e) {\n      const {\n        clientX,\n        clientY\n      } = e;\n      offsetX = clientX - startX;\n      offsetY = clientY - startY;\n      beforeNextFrameOnce(derivePreviewStyle);\n    }\n    function getMoveStrategy(opts) {\n      const {\n        mouseUpClientX,\n        mouseUpClientY,\n        mouseDownClientX,\n        mouseDownClientY\n      } = opts;\n      const deltaHorizontal = mouseDownClientX - mouseUpClientX;\n      const deltaVertical = mouseDownClientY - mouseUpClientY;\n      const moveVerticalDirection = `vertical${deltaVertical > 0 ? 'Top' : 'Bottom'}`;\n      const moveHorizontalDirection = `horizontal${deltaHorizontal > 0 ? 'Left' : 'Right'}`;\n      return {\n        moveVerticalDirection,\n        moveHorizontalDirection,\n        deltaHorizontal,\n        deltaVertical\n      };\n    }\n    // avoid image move outside viewport\n    function getDerivedOffset(moveStrategy) {\n      const {\n        value: preview\n      } = previewRef;\n      if (!preview) return {\n        offsetX: 0,\n        offsetY: 0\n      };\n      const pbox = preview.getBoundingClientRect();\n      const {\n        moveVerticalDirection,\n        moveHorizontalDirection,\n        deltaHorizontal,\n        deltaVertical\n      } = moveStrategy || {};\n      let nextOffsetX = 0;\n      let nextOffsetY = 0;\n      if (pbox.width <= window.innerWidth) {\n        nextOffsetX = 0;\n      } else if (pbox.left > 0) {\n        nextOffsetX = (pbox.width - window.innerWidth) / 2;\n      } else if (pbox.right < window.innerWidth) {\n        nextOffsetX = -(pbox.width - window.innerWidth) / 2;\n      } else if (moveHorizontalDirection === 'horizontalRight') {\n        nextOffsetX = Math.min((pbox.width - window.innerWidth) / 2, startOffsetX - (deltaHorizontal !== null && deltaHorizontal !== void 0 ? deltaHorizontal : 0));\n      } else {\n        nextOffsetX = Math.max(-((pbox.width - window.innerWidth) / 2), startOffsetX - (deltaHorizontal !== null && deltaHorizontal !== void 0 ? deltaHorizontal : 0));\n      }\n      if (pbox.height <= window.innerHeight) {\n        nextOffsetY = 0;\n      } else if (pbox.top > 0) {\n        nextOffsetY = (pbox.height - window.innerHeight) / 2;\n      } else if (pbox.bottom < window.innerHeight) {\n        nextOffsetY = -(pbox.height - window.innerHeight) / 2;\n      } else if (moveVerticalDirection === 'verticalBottom') {\n        nextOffsetY = Math.min((pbox.height - window.innerHeight) / 2, startOffsetY - (deltaVertical !== null && deltaVertical !== void 0 ? deltaVertical : 0));\n      } else {\n        nextOffsetY = Math.max(-((pbox.height - window.innerHeight) / 2), startOffsetY - (deltaVertical !== null && deltaVertical !== void 0 ? deltaVertical : 0));\n      }\n      return {\n        offsetX: nextOffsetX,\n        offsetY: nextOffsetY\n      };\n    }\n    function handleMouseUp(e) {\n      off('mousemove', document, handleMouseMove);\n      off('mouseup', document, handleMouseUp);\n      const {\n        clientX: mouseUpClientX,\n        clientY: mouseUpClientY\n      } = e;\n      dragging = false;\n      const moveStrategy = getMoveStrategy({\n        mouseUpClientX,\n        mouseUpClientY,\n        mouseDownClientX,\n        mouseDownClientY\n      });\n      const offset = getDerivedOffset(moveStrategy);\n      offsetX = offset.offsetX;\n      offsetY = offset.offsetY;\n      derivePreviewStyle();\n    }\n    const imageContext = inject(imageContextKey, null);\n    function handlePreviewMousedown(e) {\n      var _a, _b;\n      (_b = (_a = imageContext === null || imageContext === void 0 ? void 0 : imageContext.previewedImgPropsRef.value) === null || _a === void 0 ? void 0 : _a.onMousedown) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n      if (e.button !== 0) return;\n      const {\n        clientX,\n        clientY\n      } = e;\n      dragging = true;\n      startX = clientX - offsetX;\n      startY = clientY - offsetY;\n      startOffsetX = offsetX;\n      startOffsetY = offsetY;\n      mouseDownClientX = clientX;\n      mouseDownClientY = clientY;\n      derivePreviewStyle();\n      on('mousemove', document, handleMouseMove);\n      on('mouseup', document, handleMouseUp);\n    }\n    function handlePreviewDblclick(e) {\n      var _a, _b;\n      (_b = (_a = imageContext === null || imageContext === void 0 ? void 0 : imageContext.previewedImgPropsRef.value) === null || _a === void 0 ? void 0 : _a.onDblclick) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n      const originalImageSizeScale = getOrignalImageSizeScale();\n      scale = scale === originalImageSizeScale ? 1 : originalImageSizeScale;\n      derivePreviewStyle();\n    }\n    const scaleRadix = 1.5;\n    let scaleExp = 0;\n    let scale = 1;\n    let rotate = 0;\n    function resetScale() {\n      scale = 1;\n      scaleExp = 0;\n    }\n    function handleSwitchPrev() {\n      var _a;\n      resetScale();\n      rotate = 0;\n      (_a = props.onPrev) === null || _a === void 0 ? void 0 : _a.call(props);\n    }\n    function handleSwitchNext() {\n      var _a;\n      resetScale();\n      rotate = 0;\n      (_a = props.onNext) === null || _a === void 0 ? void 0 : _a.call(props);\n    }\n    function rotateCounterclockwise() {\n      rotate -= 90;\n      derivePreviewStyle();\n    }\n    function rotateClockwise() {\n      rotate += 90;\n      derivePreviewStyle();\n    }\n    function getMaxScale() {\n      const {\n        value: preview\n      } = previewRef;\n      if (!preview) return 1;\n      const {\n        innerWidth,\n        innerHeight\n      } = window;\n      const heightMaxScale = Math.max(1, preview.naturalHeight / (innerHeight - BLEEDING));\n      const widthMaxScale = Math.max(1, preview.naturalWidth / (innerWidth - BLEEDING));\n      return Math.max(3, heightMaxScale * 2, widthMaxScale * 2);\n    }\n    function getOrignalImageSizeScale() {\n      const {\n        value: preview\n      } = previewRef;\n      if (!preview) return 1;\n      const {\n        innerWidth,\n        innerHeight\n      } = window;\n      const heightScale = preview.naturalHeight / (innerHeight - BLEEDING);\n      const widthScale = preview.naturalWidth / (innerWidth - BLEEDING);\n      if (heightScale < 1 && widthScale < 1) {\n        return 1;\n      }\n      return Math.max(heightScale, widthScale);\n    }\n    function zoomIn() {\n      const maxScale = getMaxScale();\n      if (scale < maxScale) {\n        scaleExp += 1;\n        scale = Math.min(maxScale, Math.pow(scaleRadix, scaleExp));\n        derivePreviewStyle();\n      }\n    }\n    function zoomOut() {\n      if (scale > 0.5) {\n        const originalScale = scale;\n        scaleExp -= 1;\n        scale = Math.max(0.5, Math.pow(scaleRadix, scaleExp));\n        const diff = originalScale - scale;\n        derivePreviewStyle(false);\n        const offset = getDerivedOffset();\n        scale += diff;\n        derivePreviewStyle(false);\n        scale -= diff;\n        offsetX = offset.offsetX;\n        offsetY = offset.offsetY;\n        derivePreviewStyle();\n      }\n    }\n    function handleDownloadClick() {\n      const src = previewSrcRef.value;\n      if (src) {\n        download(src, undefined);\n      }\n    }\n    function derivePreviewStyle(transition = true) {\n      var _a;\n      const {\n        value: preview\n      } = previewRef;\n      if (!preview) return;\n      const {\n        style\n      } = preview;\n      const controlledStyle = normalizeStyle((_a = imageContext === null || imageContext === void 0 ? void 0 : imageContext.previewedImgPropsRef.value) === null || _a === void 0 ? void 0 : _a.style);\n      let controlledStyleString = '';\n      if (typeof controlledStyle === 'string') {\n        controlledStyleString = controlledStyle + ';';\n      } else {\n        for (const key in controlledStyle) {\n          controlledStyleString += `${kebabCase(key)}: ${controlledStyle[key]};`;\n        }\n      }\n      const transformStyle = `transform-origin: center; transform: translateX(${offsetX}px) translateY(${offsetY}px) rotate(${rotate}deg) scale(${scale});`;\n      if (dragging) {\n        style.cssText = controlledStyleString + 'cursor: grabbing; transition: none;' + transformStyle;\n      } else {\n        style.cssText = controlledStyleString + 'cursor: grab;' + transformStyle + (transition ? '' : 'transition: none;');\n      }\n      if (!transition) {\n        void preview.offsetHeight;\n      }\n    }\n    function toggleShow() {\n      showRef.value = !showRef.value;\n      displayedRef.value = true;\n    }\n    function resizeToOrignalImageSize() {\n      scale = getOrignalImageSizeScale();\n      scaleExp = Math.ceil(Math.log(scale) / Math.log(scaleRadix));\n      offsetX = 0;\n      offsetY = 0;\n      derivePreviewStyle();\n    }\n    const exposedMethods = {\n      setPreviewSrc: src => {\n        previewSrcRef.value = src;\n      },\n      setThumbnailEl: el => {\n        thumbnailEl = el;\n      },\n      toggleShow\n    };\n    function withTooltip(node, tooltipKey) {\n      if (props.showToolbarTooltip) {\n        const {\n          value: theme\n        } = themeRef;\n        return h(NTooltip, {\n          to: false,\n          theme: theme.peers.Tooltip,\n          themeOverrides: theme.peerOverrides.Tooltip,\n          keepAliveOnHover: false\n        }, {\n          default: () => {\n            return localeRef.value[tooltipKey];\n          },\n          trigger: () => node\n        });\n      } else {\n        return node;\n      }\n    }\n    const cssVarsRef = computed(() => {\n      const {\n        common: {\n          cubicBezierEaseInOut\n        },\n        self: {\n          toolbarIconColor,\n          toolbarBorderRadius,\n          toolbarBoxShadow,\n          toolbarColor\n        }\n      } = themeRef.value;\n      return {\n        '--n-bezier': cubicBezierEaseInOut,\n        '--n-toolbar-icon-color': toolbarIconColor,\n        '--n-toolbar-color': toolbarColor,\n        '--n-toolbar-border-radius': toolbarBorderRadius,\n        '--n-toolbar-box-shadow': toolbarBoxShadow\n      };\n    });\n    const {\n      inlineThemeDisabled\n    } = useConfig();\n    const themeClassHandle = inlineThemeDisabled ? useThemeClass('image-preview', undefined, cssVarsRef, props) : undefined;\n    return Object.assign({\n      previewRef,\n      previewWrapperRef,\n      previewSrc: previewSrcRef,\n      show: showRef,\n      appear: useIsMounted(),\n      displayed: displayedRef,\n      previewedImgProps: imageContext === null || imageContext === void 0 ? void 0 : imageContext.previewedImgPropsRef,\n      handleWheel(e) {\n        e.preventDefault();\n      },\n      handlePreviewMousedown,\n      handlePreviewDblclick,\n      syncTransformOrigin,\n      handleAfterLeave: () => {\n        resetScale();\n        rotate = 0;\n        displayedRef.value = false;\n      },\n      handleDragStart: e => {\n        var _a, _b;\n        (_b = (_a = imageContext === null || imageContext === void 0 ? void 0 : imageContext.previewedImgPropsRef.value) === null || _a === void 0 ? void 0 : _a.onDragstart) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n        e.preventDefault();\n      },\n      zoomIn,\n      zoomOut,\n      handleDownloadClick,\n      rotateCounterclockwise,\n      rotateClockwise,\n      handleSwitchPrev,\n      handleSwitchNext,\n      withTooltip,\n      resizeToOrignalImageSize,\n      cssVars: inlineThemeDisabled ? undefined : cssVarsRef,\n      themeClass: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass,\n      onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender\n    }, exposedMethods);\n  },\n  render() {\n    var _a, _b;\n    const {\n      clsPrefix,\n      renderToolbar,\n      withTooltip\n    } = this;\n    const prevNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.handleSwitchPrev\n    }, {\n      default: () => prevIcon\n    }), 'tipPrevious');\n    const nextNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.handleSwitchNext\n    }, {\n      default: () => nextIcon\n    }), 'tipNext');\n    const rotateCounterclockwiseNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.rotateCounterclockwise\n    }, {\n      default: () => h(RotateCounterclockwiseIcon, null)\n    }), 'tipCounterclockwise');\n    const rotateClockwiseNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.rotateClockwise\n    }, {\n      default: () => h(RotateClockwiseIcon, null)\n    }), 'tipClockwise');\n    const originalSizeNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.resizeToOrignalImageSize\n    }, {\n      default: () => {\n        return h(ResizeSmallIcon, null);\n      }\n    }), 'tipOriginalSize');\n    const zoomOutNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.zoomOut\n    }, {\n      default: () => h(ZoomOutIcon, null)\n    }), 'tipZoomOut');\n    const downloadNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.handleDownloadClick\n    }, {\n      default: () => h(DownloadIcon, null)\n    }), 'tipDownload');\n    const closeNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.toggleShow\n    }, {\n      default: () => closeIcon\n    }), 'tipClose');\n    const zoomInNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.zoomIn\n    }, {\n      default: () => h(ZoomInIcon, null)\n    }), 'tipZoomIn');\n    return h(Fragment, null, (_b = (_a = this.$slots).default) === null || _b === void 0 ? void 0 : _b.call(_a), h(LazyTeleport, {\n      show: this.show\n    }, {\n      default: () => {\n        var _a;\n        if (!(this.show || this.displayed)) {\n          return null;\n        }\n        (_a = this.onRender) === null || _a === void 0 ? void 0 : _a.call(this);\n        return withDirectives(h(\"div\", {\n          class: [`${clsPrefix}-image-preview-container`, this.themeClass],\n          style: this.cssVars,\n          onWheel: this.handleWheel\n        }, h(Transition, {\n          name: \"fade-in-transition\",\n          appear: this.appear\n        }, {\n          default: () => this.show ? h(\"div\", {\n            class: `${clsPrefix}-image-preview-overlay`,\n            onClick: this.toggleShow\n          }) : null\n        }), this.showToolbar ? h(Transition, {\n          name: \"fade-in-transition\",\n          appear: this.appear\n        }, {\n          default: () => {\n            if (!this.show) return null;\n            return h(\"div\", {\n              class: `${clsPrefix}-image-preview-toolbar`\n            }, renderToolbar ? renderToolbar({\n              nodes: {\n                prev: prevNode,\n                next: nextNode,\n                rotateCounterclockwise: rotateCounterclockwiseNode,\n                rotateClockwise: rotateClockwiseNode,\n                resizeToOriginalSize: originalSizeNode,\n                zoomOut: zoomOutNode,\n                zoomIn: zoomInNode,\n                download: downloadNode,\n                close: closeNode\n              }\n            }) : h(Fragment, null, this.onPrev ? h(Fragment, null, prevNode, nextNode) : null, rotateCounterclockwiseNode, rotateClockwiseNode, originalSizeNode, zoomOutNode, zoomInNode, downloadNode, closeNode));\n          }\n        }) : null, h(Transition, {\n          name: \"fade-in-scale-up-transition\",\n          onAfterLeave: this.handleAfterLeave,\n          appear: this.appear,\n          // BUG:\n          // onEnter will be called twice, I don't know why\n          // Maybe it is a bug of vue\n          onEnter: this.syncTransformOrigin,\n          onBeforeLeave: this.syncTransformOrigin\n        }, {\n          default: () => {\n            const {\n              previewedImgProps = {}\n            } = this;\n            return withDirectives(h(\"div\", {\n              class: `${clsPrefix}-image-preview-wrapper`,\n              ref: \"previewWrapperRef\"\n            }, h(\"img\", Object.assign({}, previewedImgProps, {\n              draggable: false,\n              onMousedown: this.handlePreviewMousedown,\n              onDblclick: this.handlePreviewDblclick,\n              class: [`${clsPrefix}-image-preview`, previewedImgProps.class],\n              key: this.previewSrc,\n              src: this.previewSrc,\n              ref: \"previewRef\",\n              onDragstart: this.handleDragStart\n            }))), [[vShow, this.show]]);\n          }\n        })), [[zindexable, {\n          enabled: this.show\n        }]]);\n      }\n    }));\n  }\n});","map":{"version":3,"names":["h","defineComponent","Fragment","ref","withDirectives","Transition","vShow","watch","computed","toRef","onBeforeUnmount","inject","normalizeStyle","zindexable","useIsMounted","LazyTeleport","on","off","beforeNextFrameOnce","kebabCase","RotateClockwiseIcon","RotateCounterclockwiseIcon","ZoomInIcon","ZoomOutIcon","ResizeSmallIcon","DownloadIcon","useConfig","useLocale","useTheme","useThemeClass","NBaseIcon","download","NTooltip","imageLight","prevIcon","nextIcon","closeIcon","imageContextKey","imagePreviewSharedProps","style","BLEEDING","name","props","Object","assign","onNext","Function","onPrev","clsPrefix","type","String","required","setup","themeRef","thumbnailEl","previewRef","previewWrapperRef","previewSrcRef","undefined","showRef","displayedRef","localeRef","syncTransformOrigin","value","previewWrapper","tbox","getBoundingClientRect","tx","left","width","ty","top","height","transformOrigin","handleKeydown","e","_a","_b","key","preventDefault","call","toggleShow","document","startX","startY","offsetX","offsetY","startOffsetX","startOffsetY","mouseDownClientX","mouseDownClientY","dragging","handleMouseMove","clientX","clientY","derivePreviewStyle","getMoveStrategy","opts","mouseUpClientX","mouseUpClientY","deltaHorizontal","deltaVertical","moveVerticalDirection","moveHorizontalDirection","getDerivedOffset","moveStrategy","preview","pbox","nextOffsetX","nextOffsetY","window","innerWidth","right","Math","min","max","innerHeight","bottom","handleMouseUp","offset","imageContext","handlePreviewMousedown","previewedImgPropsRef","onMousedown","button","handlePreviewDblclick","onDblclick","originalImageSizeScale","getOrignalImageSizeScale","scale","scaleRadix","scaleExp","rotate","resetScale","handleSwitchPrev","handleSwitchNext","rotateCounterclockwise","rotateClockwise","getMaxScale","heightMaxScale","naturalHeight","widthMaxScale","naturalWidth","heightScale","widthScale","zoomIn","maxScale","pow","zoomOut","originalScale","diff","handleDownloadClick","src","transition","controlledStyle","controlledStyleString","transformStyle","cssText","offsetHeight","resizeToOrignalImageSize","ceil","log","exposedMethods","setPreviewSrc","setThumbnailEl","el","withTooltip","node","tooltipKey","showToolbarTooltip","theme","to","peers","Tooltip","themeOverrides","peerOverrides","keepAliveOnHover","default","trigger","cssVarsRef","common","cubicBezierEaseInOut","self","toolbarIconColor","toolbarBorderRadius","toolbarBoxShadow","toolbarColor","inlineThemeDisabled","themeClassHandle","previewSrc","show","appear","displayed","previewedImgProps","handleWheel","handleAfterLeave","handleDragStart","onDragstart","cssVars","themeClass","onRender","render","renderToolbar","prevNode","onClick","nextNode","rotateCounterclockwiseNode","rotateClockwiseNode","originalSizeNode","zoomOutNode","downloadNode","closeNode","zoomInNode","$slots","class","onWheel","showToolbar","nodes","prev","next","resizeToOriginalSize","close","onAfterLeave","onEnter","onBeforeLeave","draggable","enabled"],"sources":["/Users/wangjohnson/ai_marketing/frontend/node_modules/naive-ui/es/image/src/ImagePreview.mjs"],"sourcesContent":["import { h, defineComponent, Fragment, ref, withDirectives, Transition, vShow, watch, computed, toRef, onBeforeUnmount, inject, normalizeStyle } from 'vue';\nimport { zindexable } from 'vdirs';\nimport { useIsMounted } from 'vooks';\nimport { LazyTeleport } from 'vueuc';\nimport { on, off } from 'evtd';\nimport { beforeNextFrameOnce } from 'seemly';\nimport { kebabCase } from 'lodash-es';\nimport { RotateClockwiseIcon, RotateCounterclockwiseIcon, ZoomInIcon, ZoomOutIcon, ResizeSmallIcon, DownloadIcon } from \"../../_internal/icons/index.mjs\";\nimport { useConfig, useLocale, useTheme, useThemeClass } from \"../../_mixins/index.mjs\";\nimport { NBaseIcon } from \"../../_internal/index.mjs\";\nimport { download } from \"../../_utils/index.mjs\";\nimport { NTooltip } from \"../../tooltip/index.mjs\";\nimport { imageLight } from \"../styles/index.mjs\";\nimport { prevIcon, nextIcon, closeIcon } from \"./icons.mjs\";\nimport { imageContextKey, imagePreviewSharedProps } from \"./interface.mjs\";\nimport style from \"./styles/index.cssr.mjs\";\nconst BLEEDING = 32;\nexport default defineComponent({\n  name: 'ImagePreview',\n  props: Object.assign(Object.assign({}, imagePreviewSharedProps), {\n    onNext: Function,\n    onPrev: Function,\n    clsPrefix: {\n      type: String,\n      required: true\n    }\n  }),\n  setup(props) {\n    const themeRef = useTheme('Image', '-image', style, imageLight, props, toRef(props, 'clsPrefix'));\n    let thumbnailEl = null;\n    const previewRef = ref(null);\n    const previewWrapperRef = ref(null);\n    const previewSrcRef = ref(undefined);\n    const showRef = ref(false);\n    const displayedRef = ref(false);\n    const {\n      localeRef\n    } = useLocale('Image');\n    function syncTransformOrigin() {\n      const {\n        value: previewWrapper\n      } = previewWrapperRef;\n      if (!thumbnailEl || !previewWrapper) return;\n      const {\n        style\n      } = previewWrapper;\n      const tbox = thumbnailEl.getBoundingClientRect();\n      const tx = tbox.left + tbox.width / 2;\n      const ty = tbox.top + tbox.height / 2;\n      style.transformOrigin = `${tx}px ${ty}px`;\n    }\n    function handleKeydown(e) {\n      var _a, _b;\n      switch (e.key) {\n        case ' ':\n          e.preventDefault();\n          break;\n        case 'ArrowLeft':\n          (_a = props.onPrev) === null || _a === void 0 ? void 0 : _a.call(props);\n          break;\n        case 'ArrowRight':\n          (_b = props.onNext) === null || _b === void 0 ? void 0 : _b.call(props);\n          break;\n        case 'Escape':\n          toggleShow();\n          break;\n      }\n    }\n    watch(showRef, value => {\n      if (value) {\n        on('keydown', document, handleKeydown);\n      } else off('keydown', document, handleKeydown);\n    });\n    onBeforeUnmount(() => {\n      off('keydown', document, handleKeydown);\n    });\n    let startX = 0;\n    let startY = 0;\n    let offsetX = 0;\n    let offsetY = 0;\n    let startOffsetX = 0;\n    let startOffsetY = 0;\n    let mouseDownClientX = 0;\n    let mouseDownClientY = 0;\n    let dragging = false;\n    function handleMouseMove(e) {\n      const {\n        clientX,\n        clientY\n      } = e;\n      offsetX = clientX - startX;\n      offsetY = clientY - startY;\n      beforeNextFrameOnce(derivePreviewStyle);\n    }\n    function getMoveStrategy(opts) {\n      const {\n        mouseUpClientX,\n        mouseUpClientY,\n        mouseDownClientX,\n        mouseDownClientY\n      } = opts;\n      const deltaHorizontal = mouseDownClientX - mouseUpClientX;\n      const deltaVertical = mouseDownClientY - mouseUpClientY;\n      const moveVerticalDirection = `vertical${deltaVertical > 0 ? 'Top' : 'Bottom'}`;\n      const moveHorizontalDirection = `horizontal${deltaHorizontal > 0 ? 'Left' : 'Right'}`;\n      return {\n        moveVerticalDirection,\n        moveHorizontalDirection,\n        deltaHorizontal,\n        deltaVertical\n      };\n    }\n    // avoid image move outside viewport\n    function getDerivedOffset(moveStrategy) {\n      const {\n        value: preview\n      } = previewRef;\n      if (!preview) return {\n        offsetX: 0,\n        offsetY: 0\n      };\n      const pbox = preview.getBoundingClientRect();\n      const {\n        moveVerticalDirection,\n        moveHorizontalDirection,\n        deltaHorizontal,\n        deltaVertical\n      } = moveStrategy || {};\n      let nextOffsetX = 0;\n      let nextOffsetY = 0;\n      if (pbox.width <= window.innerWidth) {\n        nextOffsetX = 0;\n      } else if (pbox.left > 0) {\n        nextOffsetX = (pbox.width - window.innerWidth) / 2;\n      } else if (pbox.right < window.innerWidth) {\n        nextOffsetX = -(pbox.width - window.innerWidth) / 2;\n      } else if (moveHorizontalDirection === 'horizontalRight') {\n        nextOffsetX = Math.min((pbox.width - window.innerWidth) / 2, startOffsetX - (deltaHorizontal !== null && deltaHorizontal !== void 0 ? deltaHorizontal : 0));\n      } else {\n        nextOffsetX = Math.max(-((pbox.width - window.innerWidth) / 2), startOffsetX - (deltaHorizontal !== null && deltaHorizontal !== void 0 ? deltaHorizontal : 0));\n      }\n      if (pbox.height <= window.innerHeight) {\n        nextOffsetY = 0;\n      } else if (pbox.top > 0) {\n        nextOffsetY = (pbox.height - window.innerHeight) / 2;\n      } else if (pbox.bottom < window.innerHeight) {\n        nextOffsetY = -(pbox.height - window.innerHeight) / 2;\n      } else if (moveVerticalDirection === 'verticalBottom') {\n        nextOffsetY = Math.min((pbox.height - window.innerHeight) / 2, startOffsetY - (deltaVertical !== null && deltaVertical !== void 0 ? deltaVertical : 0));\n      } else {\n        nextOffsetY = Math.max(-((pbox.height - window.innerHeight) / 2), startOffsetY - (deltaVertical !== null && deltaVertical !== void 0 ? deltaVertical : 0));\n      }\n      return {\n        offsetX: nextOffsetX,\n        offsetY: nextOffsetY\n      };\n    }\n    function handleMouseUp(e) {\n      off('mousemove', document, handleMouseMove);\n      off('mouseup', document, handleMouseUp);\n      const {\n        clientX: mouseUpClientX,\n        clientY: mouseUpClientY\n      } = e;\n      dragging = false;\n      const moveStrategy = getMoveStrategy({\n        mouseUpClientX,\n        mouseUpClientY,\n        mouseDownClientX,\n        mouseDownClientY\n      });\n      const offset = getDerivedOffset(moveStrategy);\n      offsetX = offset.offsetX;\n      offsetY = offset.offsetY;\n      derivePreviewStyle();\n    }\n    const imageContext = inject(imageContextKey, null);\n    function handlePreviewMousedown(e) {\n      var _a, _b;\n      (_b = (_a = imageContext === null || imageContext === void 0 ? void 0 : imageContext.previewedImgPropsRef.value) === null || _a === void 0 ? void 0 : _a.onMousedown) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n      if (e.button !== 0) return;\n      const {\n        clientX,\n        clientY\n      } = e;\n      dragging = true;\n      startX = clientX - offsetX;\n      startY = clientY - offsetY;\n      startOffsetX = offsetX;\n      startOffsetY = offsetY;\n      mouseDownClientX = clientX;\n      mouseDownClientY = clientY;\n      derivePreviewStyle();\n      on('mousemove', document, handleMouseMove);\n      on('mouseup', document, handleMouseUp);\n    }\n    function handlePreviewDblclick(e) {\n      var _a, _b;\n      (_b = (_a = imageContext === null || imageContext === void 0 ? void 0 : imageContext.previewedImgPropsRef.value) === null || _a === void 0 ? void 0 : _a.onDblclick) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n      const originalImageSizeScale = getOrignalImageSizeScale();\n      scale = scale === originalImageSizeScale ? 1 : originalImageSizeScale;\n      derivePreviewStyle();\n    }\n    const scaleRadix = 1.5;\n    let scaleExp = 0;\n    let scale = 1;\n    let rotate = 0;\n    function resetScale() {\n      scale = 1;\n      scaleExp = 0;\n    }\n    function handleSwitchPrev() {\n      var _a;\n      resetScale();\n      rotate = 0;\n      (_a = props.onPrev) === null || _a === void 0 ? void 0 : _a.call(props);\n    }\n    function handleSwitchNext() {\n      var _a;\n      resetScale();\n      rotate = 0;\n      (_a = props.onNext) === null || _a === void 0 ? void 0 : _a.call(props);\n    }\n    function rotateCounterclockwise() {\n      rotate -= 90;\n      derivePreviewStyle();\n    }\n    function rotateClockwise() {\n      rotate += 90;\n      derivePreviewStyle();\n    }\n    function getMaxScale() {\n      const {\n        value: preview\n      } = previewRef;\n      if (!preview) return 1;\n      const {\n        innerWidth,\n        innerHeight\n      } = window;\n      const heightMaxScale = Math.max(1, preview.naturalHeight / (innerHeight - BLEEDING));\n      const widthMaxScale = Math.max(1, preview.naturalWidth / (innerWidth - BLEEDING));\n      return Math.max(3, heightMaxScale * 2, widthMaxScale * 2);\n    }\n    function getOrignalImageSizeScale() {\n      const {\n        value: preview\n      } = previewRef;\n      if (!preview) return 1;\n      const {\n        innerWidth,\n        innerHeight\n      } = window;\n      const heightScale = preview.naturalHeight / (innerHeight - BLEEDING);\n      const widthScale = preview.naturalWidth / (innerWidth - BLEEDING);\n      if (heightScale < 1 && widthScale < 1) {\n        return 1;\n      }\n      return Math.max(heightScale, widthScale);\n    }\n    function zoomIn() {\n      const maxScale = getMaxScale();\n      if (scale < maxScale) {\n        scaleExp += 1;\n        scale = Math.min(maxScale, Math.pow(scaleRadix, scaleExp));\n        derivePreviewStyle();\n      }\n    }\n    function zoomOut() {\n      if (scale > 0.5) {\n        const originalScale = scale;\n        scaleExp -= 1;\n        scale = Math.max(0.5, Math.pow(scaleRadix, scaleExp));\n        const diff = originalScale - scale;\n        derivePreviewStyle(false);\n        const offset = getDerivedOffset();\n        scale += diff;\n        derivePreviewStyle(false);\n        scale -= diff;\n        offsetX = offset.offsetX;\n        offsetY = offset.offsetY;\n        derivePreviewStyle();\n      }\n    }\n    function handleDownloadClick() {\n      const src = previewSrcRef.value;\n      if (src) {\n        download(src, undefined);\n      }\n    }\n    function derivePreviewStyle(transition = true) {\n      var _a;\n      const {\n        value: preview\n      } = previewRef;\n      if (!preview) return;\n      const {\n        style\n      } = preview;\n      const controlledStyle = normalizeStyle((_a = imageContext === null || imageContext === void 0 ? void 0 : imageContext.previewedImgPropsRef.value) === null || _a === void 0 ? void 0 : _a.style);\n      let controlledStyleString = '';\n      if (typeof controlledStyle === 'string') {\n        controlledStyleString = controlledStyle + ';';\n      } else {\n        for (const key in controlledStyle) {\n          controlledStyleString += `${kebabCase(key)}: ${controlledStyle[key]};`;\n        }\n      }\n      const transformStyle = `transform-origin: center; transform: translateX(${offsetX}px) translateY(${offsetY}px) rotate(${rotate}deg) scale(${scale});`;\n      if (dragging) {\n        style.cssText = controlledStyleString + 'cursor: grabbing; transition: none;' + transformStyle;\n      } else {\n        style.cssText = controlledStyleString + 'cursor: grab;' + transformStyle + (transition ? '' : 'transition: none;');\n      }\n      if (!transition) {\n        void preview.offsetHeight;\n      }\n    }\n    function toggleShow() {\n      showRef.value = !showRef.value;\n      displayedRef.value = true;\n    }\n    function resizeToOrignalImageSize() {\n      scale = getOrignalImageSizeScale();\n      scaleExp = Math.ceil(Math.log(scale) / Math.log(scaleRadix));\n      offsetX = 0;\n      offsetY = 0;\n      derivePreviewStyle();\n    }\n    const exposedMethods = {\n      setPreviewSrc: src => {\n        previewSrcRef.value = src;\n      },\n      setThumbnailEl: el => {\n        thumbnailEl = el;\n      },\n      toggleShow\n    };\n    function withTooltip(node, tooltipKey) {\n      if (props.showToolbarTooltip) {\n        const {\n          value: theme\n        } = themeRef;\n        return h(NTooltip, {\n          to: false,\n          theme: theme.peers.Tooltip,\n          themeOverrides: theme.peerOverrides.Tooltip,\n          keepAliveOnHover: false\n        }, {\n          default: () => {\n            return localeRef.value[tooltipKey];\n          },\n          trigger: () => node\n        });\n      } else {\n        return node;\n      }\n    }\n    const cssVarsRef = computed(() => {\n      const {\n        common: {\n          cubicBezierEaseInOut\n        },\n        self: {\n          toolbarIconColor,\n          toolbarBorderRadius,\n          toolbarBoxShadow,\n          toolbarColor\n        }\n      } = themeRef.value;\n      return {\n        '--n-bezier': cubicBezierEaseInOut,\n        '--n-toolbar-icon-color': toolbarIconColor,\n        '--n-toolbar-color': toolbarColor,\n        '--n-toolbar-border-radius': toolbarBorderRadius,\n        '--n-toolbar-box-shadow': toolbarBoxShadow\n      };\n    });\n    const {\n      inlineThemeDisabled\n    } = useConfig();\n    const themeClassHandle = inlineThemeDisabled ? useThemeClass('image-preview', undefined, cssVarsRef, props) : undefined;\n    return Object.assign({\n      previewRef,\n      previewWrapperRef,\n      previewSrc: previewSrcRef,\n      show: showRef,\n      appear: useIsMounted(),\n      displayed: displayedRef,\n      previewedImgProps: imageContext === null || imageContext === void 0 ? void 0 : imageContext.previewedImgPropsRef,\n      handleWheel(e) {\n        e.preventDefault();\n      },\n      handlePreviewMousedown,\n      handlePreviewDblclick,\n      syncTransformOrigin,\n      handleAfterLeave: () => {\n        resetScale();\n        rotate = 0;\n        displayedRef.value = false;\n      },\n      handleDragStart: e => {\n        var _a, _b;\n        (_b = (_a = imageContext === null || imageContext === void 0 ? void 0 : imageContext.previewedImgPropsRef.value) === null || _a === void 0 ? void 0 : _a.onDragstart) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n        e.preventDefault();\n      },\n      zoomIn,\n      zoomOut,\n      handleDownloadClick,\n      rotateCounterclockwise,\n      rotateClockwise,\n      handleSwitchPrev,\n      handleSwitchNext,\n      withTooltip,\n      resizeToOrignalImageSize,\n      cssVars: inlineThemeDisabled ? undefined : cssVarsRef,\n      themeClass: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass,\n      onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender\n    }, exposedMethods);\n  },\n  render() {\n    var _a, _b;\n    const {\n      clsPrefix,\n      renderToolbar,\n      withTooltip\n    } = this;\n    const prevNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.handleSwitchPrev\n    }, {\n      default: () => prevIcon\n    }), 'tipPrevious');\n    const nextNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.handleSwitchNext\n    }, {\n      default: () => nextIcon\n    }), 'tipNext');\n    const rotateCounterclockwiseNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.rotateCounterclockwise\n    }, {\n      default: () => h(RotateCounterclockwiseIcon, null)\n    }), 'tipCounterclockwise');\n    const rotateClockwiseNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.rotateClockwise\n    }, {\n      default: () => h(RotateClockwiseIcon, null)\n    }), 'tipClockwise');\n    const originalSizeNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.resizeToOrignalImageSize\n    }, {\n      default: () => {\n        return h(ResizeSmallIcon, null);\n      }\n    }), 'tipOriginalSize');\n    const zoomOutNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.zoomOut\n    }, {\n      default: () => h(ZoomOutIcon, null)\n    }), 'tipZoomOut');\n    const downloadNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.handleDownloadClick\n    }, {\n      default: () => h(DownloadIcon, null)\n    }), 'tipDownload');\n    const closeNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.toggleShow\n    }, {\n      default: () => closeIcon\n    }), 'tipClose');\n    const zoomInNode = withTooltip(h(NBaseIcon, {\n      clsPrefix: clsPrefix,\n      onClick: this.zoomIn\n    }, {\n      default: () => h(ZoomInIcon, null)\n    }), 'tipZoomIn');\n    return h(Fragment, null, (_b = (_a = this.$slots).default) === null || _b === void 0 ? void 0 : _b.call(_a), h(LazyTeleport, {\n      show: this.show\n    }, {\n      default: () => {\n        var _a;\n        if (!(this.show || this.displayed)) {\n          return null;\n        }\n        (_a = this.onRender) === null || _a === void 0 ? void 0 : _a.call(this);\n        return withDirectives(h(\"div\", {\n          class: [`${clsPrefix}-image-preview-container`, this.themeClass],\n          style: this.cssVars,\n          onWheel: this.handleWheel\n        }, h(Transition, {\n          name: \"fade-in-transition\",\n          appear: this.appear\n        }, {\n          default: () => this.show ? h(\"div\", {\n            class: `${clsPrefix}-image-preview-overlay`,\n            onClick: this.toggleShow\n          }) : null\n        }), this.showToolbar ? h(Transition, {\n          name: \"fade-in-transition\",\n          appear: this.appear\n        }, {\n          default: () => {\n            if (!this.show) return null;\n            return h(\"div\", {\n              class: `${clsPrefix}-image-preview-toolbar`\n            }, renderToolbar ? renderToolbar({\n              nodes: {\n                prev: prevNode,\n                next: nextNode,\n                rotateCounterclockwise: rotateCounterclockwiseNode,\n                rotateClockwise: rotateClockwiseNode,\n                resizeToOriginalSize: originalSizeNode,\n                zoomOut: zoomOutNode,\n                zoomIn: zoomInNode,\n                download: downloadNode,\n                close: closeNode\n              }\n            }) : h(Fragment, null, this.onPrev ? h(Fragment, null, prevNode, nextNode) : null, rotateCounterclockwiseNode, rotateClockwiseNode, originalSizeNode, zoomOutNode, zoomInNode, downloadNode, closeNode));\n          }\n        }) : null, h(Transition, {\n          name: \"fade-in-scale-up-transition\",\n          onAfterLeave: this.handleAfterLeave,\n          appear: this.appear,\n          // BUG:\n          // onEnter will be called twice, I don't know why\n          // Maybe it is a bug of vue\n          onEnter: this.syncTransformOrigin,\n          onBeforeLeave: this.syncTransformOrigin\n        }, {\n          default: () => {\n            const {\n              previewedImgProps = {}\n            } = this;\n            return withDirectives(h(\"div\", {\n              class: `${clsPrefix}-image-preview-wrapper`,\n              ref: \"previewWrapperRef\"\n            }, h(\"img\", Object.assign({}, previewedImgProps, {\n              draggable: false,\n              onMousedown: this.handlePreviewMousedown,\n              onDblclick: this.handlePreviewDblclick,\n              class: [`${clsPrefix}-image-preview`, previewedImgProps.class],\n              key: this.previewSrc,\n              src: this.previewSrc,\n              ref: \"previewRef\",\n              onDragstart: this.handleDragStart\n            }))), [[vShow, this.show]]);\n          }\n        })), [[zindexable, {\n          enabled: this.show\n        }]]);\n      }\n    }));\n  }\n});"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}