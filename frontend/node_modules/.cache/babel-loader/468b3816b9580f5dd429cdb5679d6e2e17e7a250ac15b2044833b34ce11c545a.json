{"ast":null,"code":"import { createVNode as _createVNode, withCtx as _withCtx, createTextVNode as _createTextVNode, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createVNode($setup[\"NForm\"], null, {\n    default: _withCtx(() => [_createVNode($setup[\"NFormItemRow\"], {\n      label: \"用户名\"\n    }, {\n      default: _withCtx(() => [_createVNode($setup[\"NInput\"], {\n        value: $setup.loginUsername,\n        \"onUpdate:value\": _cache[0] || (_cache[0] = $event => $setup.loginUsername = $event),\n        placeholder: \"\"\n      }, null, 8 /* PROPS */, [\"value\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode($setup[\"NFormItemRow\"], {\n      label: \"密码\"\n    }, {\n      default: _withCtx(() => [_createVNode($setup[\"NInput\"], {\n        value: $setup.loginPassword,\n        \"onUpdate:value\": _cache[1] || (_cache[1] = $event => $setup.loginPassword = $event),\n        placeholder: \"\",\n        type: \"password\",\n        \"show-password-on\": \"click\",\n        maxlength: 15\n      }, null, 8 /* PROPS */, [\"value\"])]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  }), _createVNode($setup[\"NButton\"], {\n    onClick: $setup.login,\n    type: \"primary\",\n    block: \"\",\n    secondary: \"\",\n    strong: \"\"\n  }, {\n    default: _withCtx(() => [_createTextVNode(\" 登录 \")]),\n    _: 1 /* STABLE */\n  })], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["_createElementBlock","_Fragment","_createVNode","$setup","default","_withCtx","label","value","loginUsername","_cache","$event","placeholder","_","loginPassword","type","maxlength","onClick","login","block","secondary","strong","_createTextVNode"],"sources":["/Users/wangjohnson/ai_marketing/frontend/src/components/LoginForm.vue"],"sourcesContent":["<template>\n<n-form>\n    <n-form-item-row label=\"用户名\">\n        <n-input v-model:value=\"loginUsername\" placeholder=\"\"/>\n          </n-form-item-row>\n          <n-form-item-row label=\"密码\">\n            <n-input v-model:value=\"loginPassword\" placeholder=\"\" type=\"password\" show-password-on=\"click\" :maxlength=\"15\"/>\n          </n-form-item-row>\n        </n-form>\n        <n-button @click=\"login\" type=\"primary\" block secondary strong>\n          登录\n    </n-button>\n</template>\n\n<script setup>\nimport {useNotification,NButton,NInput,NForm,NFormItemRow} from 'naive-ui';\nimport {ref,defineExpose} from 'vue';\nimport {useStore} from 'vuex';\nimport {useRouter} from 'vue-router';\nimport axios from 'axios';\n\n\n//通用变量\nconst authStore = useStore();\nconst router = useRouter();\n\n//登录表单操作\nconst loginUsername = ref('');\nconst loginPassword = ref('');\nconst keepLoggedInForDays = ref('7'); // 默认设置为7天，通过select控件让用户可选择\nconst notification=useNotification()\nconst login = async () => {\n    try{\n        const response = await axios.post('/account/login/', \n        {   \n          username: loginUsername.value,\n          password: loginPassword.value,\n          keep_logged_in_for_days: keepLoggedInForDays.value\n        },  \n        {   \n          withCredentials: true,\n          headers: {\n            //先注销'X-CSRFToken': csrfToken.value,\n          }   \n        });\n        const token = response.data.token.access;\n        const user = response.data.username;\n        //const csrf_token = response.data.csrf_token;\n        //console.log('csrf_token:',csrf_token);\n        localStorage.setItem('token', token);\n        await authStore.commit('auth_success', { token, user });\n        console.log(\"登录成功：\",loginUsername.value); \n        await router.push('/dashboard');\n        \n        }catch(err){\n            if(err.response.status==400){\n                notification.error({\n                    content:err.response.data.message,\n                    duration:2500\n                    })\n            }\n            console.log(\"登录失败：\",err)\n        }\n    }\n\n\n\n//暴露方法\ndefineExpose({login});\n</script>\n\n<style>\n.n-input{\n    text-align:left}\n</style>\n\n"],"mappings":";;uBAAAA,mBAAA,CAAAC,SAAA,SACAC,YAAA,CAOiBC,MAAA;IARjBC,OAAA,EAAAC,QAAA,CAEI,MAEwB,CAFxBH,YAAA,CAEwBC,MAAA;MAFPG,KAAK,EAAC;IAAK;MAFhCF,OAAA,EAAAC,QAAA,CAGQ,MAAuD,CAAvDH,YAAA,CAAuDC,MAAA;QAAtCI,KAAK,EAAEJ,MAAA,CAAAK,aAAa;QAH7C,kBAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAGgCP,MAAA,CAAAK,aAAa,GAAAE,MAAA;QAAEC,WAAW,EAAC;;MAH3DC,CAAA;QAKUV,YAAA,CAEkBC,MAAA;MAFDG,KAAK,EAAC;IAAI;MALrCF,OAAA,EAAAC,QAAA,CAMY,MAAgH,CAAhHH,YAAA,CAAgHC,MAAA;QAA/FI,KAAK,EAAEJ,MAAA,CAAAU,aAAa;QANjD,kBAAAJ,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAMoCP,MAAA,CAAAU,aAAa,GAAAH,MAAA;QAAEC,WAAW,EAAC,EAAE;QAACG,IAAI,EAAC,UAAU;QAAC,kBAAgB,EAAC,OAAO;QAAEC,SAAS,EAAE;;MANvHH,CAAA;;IAAAA,CAAA;MASQV,YAAA,CAEOC,MAAA;IAFIa,OAAK,EAAEb,MAAA,CAAAc,KAAK;IAAEH,IAAI,EAAC,SAAS;IAACI,KAAK,EAAL,EAAK;IAACC,SAAS,EAAT,EAAS;IAACC,MAAM,EAAN;;IAThEhB,OAAA,EAAAC,QAAA,CASuE,MAEnE,CAXJgB,gBAAA,CASuE,MAEnE,E;IAXJT,CAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}