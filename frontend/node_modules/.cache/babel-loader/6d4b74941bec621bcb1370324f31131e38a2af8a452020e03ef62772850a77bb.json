{"ast":null,"code":"// store/index.js\nimport { defineStore } from 'pinia';\nimport axios from 'axios';\nimport Vue from 'vue';\nimport Vuex from 'vuex';\nVue.use(Vuex);\nexport default new Vuex.Store({\n  state: {\n    status: '',\n    token: localStorage.getItem('token') || '',\n    user: {}\n  },\n  mutations: {\n    auth_success(state, {\n      token,\n      user\n    }) {\n      state.status = 'success';\n      state.token = token;\n      state.user = user;\n    },\n    logout(state) {\n      state.status = '';\n      state.token = '';\n    }\n  },\n  actions: {\n    logIn({\n      commit\n    }, user) {\n      return new Promise((resolve, reject) => {\n        axios({\n          url: 'http://localhost:8005l/api/account/login/',\n          data: user,\n          method: 'POST'\n        }).then(resp => {\n          const token = resp.data.token.access;\n          const user = resp.data.username;\n          localStorage.setItem('token', token);\n          axios.defaults.headers.common['Authorization'] = token;\n          commit('auth_success', {\n            token,\n            user\n          });\n          resolve(resp);\n        }).catch(err => {\n          localStorage.removeItem('token');\n          reject(err);\n        });\n      });\n    },\n    logout({\n      commit\n    }) {\n      return new Promise(resolve => {\n        commit('logout');\n        localStorage.removeItem('token');\n        delete axios.defaults.headers.common['Authorization'];\n        resolve();\n      });\n    },\n    getters: {\n      isLoggedIn: state => !!state.token,\n      authStatus: state => state.status\n    },\n    checkLoginStatus() {\n      // 根据localStorage或其他持久化存储状态恢复登录状态\n      // 例如:\n      const userData = localStorage.getItem('user');\n      if (user) {\n        const userData = JSON.parse(user);\n        const now = new Date().getTime();\n        if (userData.expiration > now) {\n          this.logIn(userData);\n        } else {\n          this.logOut(); // 清除过期Token\n        }\n      }\n    }\n  }\n});","map":{"version":3,"names":["defineStore","axios","Vue","Vuex","use","Store","state","status","token","localStorage","getItem","user","mutations","auth_success","logout","actions","logIn","commit","Promise","resolve","reject","url","data","method","then","resp","access","username","setItem","defaults","headers","common","catch","err","removeItem","getters","isLoggedIn","authStatus","checkLoginStatus","userData","JSON","parse","now","Date","getTime","expiration","logOut"],"sources":["/Users/wangjohnson/ai_marketing/frontend/src/store/index.js"],"sourcesContent":["// store/index.js\nimport { defineStore } from 'pinia';\nimport axios from 'axios'\nimport Vue from 'vue'\nimport Vuex from 'vuex'\n\nVue.use(Vuex)\nexport default new Vuex.Store({\n  state: {\n    status: '',\n    token: localStorage.getItem('token') || '',\n    user : {}\n  },\n  \n  mutations: {\n    auth_success(state, { token, user }){\n      state.status = 'success'\n      state.token = token\n      state.user = user\n    },\n    logout(state){\n      state.status = ''\n      state.token = ''\n    },\n  },\n\n  actions: {\n     logIn({commit}, user) {\n       return new Promise((resolve, reject) => {\n          axios({url: 'http://localhost:8005l/api/account/login/', data: user, method: 'POST' })\n          .then(resp => {\n            const token = resp.data.token.access\n            const user = resp.data.username\n            localStorage.setItem('token', token)\n            axios.defaults.headers.common['Authorization'] = token\n            commit('auth_success', { token, user })\n            resolve(resp)\n          })\n          .catch(err => {\n            localStorage.removeItem('token')\n            reject(err)\n          })\n       })\n     },\n\n     logout({commit}){\n       return new Promise((resolve) => {\n         commit('logout')\n         localStorage.removeItem('token')\n         delete axios.defaults.headers.common['Authorization']\n         resolve()\n       })\n     },\n     getters : {\n        isLoggedIn: state => !!state.token,\n        authStatus: state => state.status,\n    },\n\n     checkLoginStatus() {\n      // 根据localStorage或其他持久化存储状态恢复登录状态\n      // 例如:\n      const userData = localStorage.getItem('user');\n      if (user) {\n        const userData = JSON.parse(user);\n        const now = new Date().getTime();\n        if (userData.expiration > now) {\n          this.logIn(userData);\n          } \n        else {\n          this.logOut(); // 清除过期Token\n          }\n      }\n    }\n   }\n});\n\n\n\n"],"mappings":"AAAA;AACA,SAASA,WAAW,QAAQ,OAAO;AACnC,OAAOC,KAAK,MAAM,OAAO;AACzB,OAAOC,GAAG,MAAM,KAAK;AACrB,OAAOC,IAAI,MAAM,MAAM;AAEvBD,GAAG,CAACE,GAAG,CAACD,IAAI,CAAC;AACb,eAAe,IAAIA,IAAI,CAACE,KAAK,CAAC;EAC5BC,KAAK,EAAE;IACLC,MAAM,EAAE,EAAE;IACVC,KAAK,EAAEC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,IAAI,EAAE;IAC1CC,IAAI,EAAG,CAAC;EACV,CAAC;EAEDC,SAAS,EAAE;IACTC,YAAYA,CAACP,KAAK,EAAE;MAAEE,KAAK;MAAEG;IAAK,CAAC,EAAC;MAClCL,KAAK,CAACC,MAAM,GAAG,SAAS;MACxBD,KAAK,CAACE,KAAK,GAAGA,KAAK;MACnBF,KAAK,CAACK,IAAI,GAAGA,IAAI;IACnB,CAAC;IACDG,MAAMA,CAACR,KAAK,EAAC;MACXA,KAAK,CAACC,MAAM,GAAG,EAAE;MACjBD,KAAK,CAACE,KAAK,GAAG,EAAE;IAClB;EACF,CAAC;EAEDO,OAAO,EAAE;IACNC,KAAKA,CAAC;MAACC;IAAM,CAAC,EAAEN,IAAI,EAAE;MACpB,OAAO,IAAIO,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QACrCnB,KAAK,CAAC;UAACoB,GAAG,EAAE,2CAA2C;UAAEC,IAAI,EAAEX,IAAI;UAAEY,MAAM,EAAE;QAAO,CAAC,CAAC,CACrFC,IAAI,CAACC,IAAI,IAAI;UACZ,MAAMjB,KAAK,GAAGiB,IAAI,CAACH,IAAI,CAACd,KAAK,CAACkB,MAAM;UACpC,MAAMf,IAAI,GAAGc,IAAI,CAACH,IAAI,CAACK,QAAQ;UAC/BlB,YAAY,CAACmB,OAAO,CAAC,OAAO,EAAEpB,KAAK,CAAC;UACpCP,KAAK,CAAC4B,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,GAAGvB,KAAK;UACtDS,MAAM,CAAC,cAAc,EAAE;YAAET,KAAK;YAAEG;UAAK,CAAC,CAAC;UACvCQ,OAAO,CAACM,IAAI,CAAC;QACf,CAAC,CAAC,CACDO,KAAK,CAACC,GAAG,IAAI;UACZxB,YAAY,CAACyB,UAAU,CAAC,OAAO,CAAC;UAChCd,MAAM,CAACa,GAAG,CAAC;QACb,CAAC,CAAC;MACL,CAAC,CAAC;IACJ,CAAC;IAEDnB,MAAMA,CAAC;MAACG;IAAM,CAAC,EAAC;MACd,OAAO,IAAIC,OAAO,CAAEC,OAAO,IAAK;QAC9BF,MAAM,CAAC,QAAQ,CAAC;QAChBR,YAAY,CAACyB,UAAU,CAAC,OAAO,CAAC;QAChC,OAAOjC,KAAK,CAAC4B,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC;QACrDZ,OAAO,CAAC,CAAC;MACX,CAAC,CAAC;IACJ,CAAC;IACDgB,OAAO,EAAG;MACPC,UAAU,EAAE9B,KAAK,IAAI,CAAC,CAACA,KAAK,CAACE,KAAK;MAClC6B,UAAU,EAAE/B,KAAK,IAAIA,KAAK,CAACC;IAC/B,CAAC;IAEA+B,gBAAgBA,CAAA,EAAG;MAClB;MACA;MACA,MAAMC,QAAQ,GAAG9B,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC;MAC7C,IAAIC,IAAI,EAAE;QACR,MAAM4B,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAAC9B,IAAI,CAAC;QACjC,MAAM+B,GAAG,GAAG,IAAIC,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC;QAChC,IAAIL,QAAQ,CAACM,UAAU,GAAGH,GAAG,EAAE;UAC7B,IAAI,CAAC1B,KAAK,CAACuB,QAAQ,CAAC;QACpB,CAAC,MACE;UACH,IAAI,CAACO,MAAM,CAAC,CAAC,CAAC,CAAC;QACf;MACJ;IACF;EACD;AACH,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}