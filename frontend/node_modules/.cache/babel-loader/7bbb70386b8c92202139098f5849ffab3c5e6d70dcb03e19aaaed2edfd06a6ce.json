{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nimport { h, defineComponent, computed, provide, toRef, ref, Fragment, Teleport, nextTick } from 'vue';\nimport { createId } from 'seemly';\nimport { useMergedState } from 'vooks';\nimport { useConfig, useTheme, useFormItem, useThemeClass } from \"../../_mixins/index.mjs\";\nimport { warn, call, throwError } from \"../../_utils/index.mjs\";\nimport { uploadLight } from \"../styles/index.mjs\";\nimport { uploadDraggerKey } from \"./UploadDragger.mjs\";\nimport { uploadInjectionKey } from \"./interface.mjs\";\nimport { createImageDataUrl, createSettledFileInfo, environmentSupportFile, isImageFile, matchType } from \"./utils.mjs\";\nimport NUploadTrigger from \"./UploadTrigger.mjs\";\nimport NUploadFileList from \"./UploadFileList.mjs\";\nimport style from \"./styles/index.cssr.mjs\";\n/**\n * fils status ['pending', 'uploading', 'finished', 'removed', 'error']\n */\nfunction createXhrHandlers(inst, file, xhr) {\n  const {\n    doChange,\n    xhrMap\n  } = inst;\n  let percentage = 0;\n  function handleXHRError(e) {\n    var _a;\n    let fileAfterChange = Object.assign({}, file, {\n      status: 'error',\n      percentage\n    });\n    xhrMap.delete(file.id);\n    fileAfterChange = createSettledFileInfo(((_a = inst.onError) === null || _a === void 0 ? void 0 : _a.call(inst, {\n      file: fileAfterChange,\n      event: e\n    })) || fileAfterChange);\n    doChange(fileAfterChange, e);\n  }\n  function handleXHRLoad(e) {\n    var _a;\n    if (inst.isErrorState) {\n      if (inst.isErrorState(xhr)) {\n        handleXHRError(e);\n        return;\n      }\n    } else {\n      if (xhr.status < 200 || xhr.status >= 300) {\n        handleXHRError(e);\n        return;\n      }\n    }\n    let fileAfterChange = Object.assign({}, file, {\n      status: 'finished',\n      percentage\n    });\n    xhrMap.delete(file.id);\n    fileAfterChange = createSettledFileInfo(((_a = inst.onFinish) === null || _a === void 0 ? void 0 : _a.call(inst, {\n      file: fileAfterChange,\n      event: e\n    })) || fileAfterChange);\n    doChange(fileAfterChange, e);\n  }\n  return {\n    handleXHRLoad,\n    handleXHRError,\n    handleXHRAbort(e) {\n      const fileAfterChange = Object.assign({}, file, {\n        status: 'removed',\n        file: null,\n        percentage\n      });\n      xhrMap.delete(file.id);\n      doChange(fileAfterChange, e);\n    },\n    handleXHRProgress(e) {\n      const fileAfterChange = Object.assign({}, file, {\n        status: 'uploading'\n      });\n      if (e.lengthComputable) {\n        const progress = Math.ceil(e.loaded / e.total * 100);\n        fileAfterChange.percentage = progress;\n        percentage = progress;\n      }\n      doChange(fileAfterChange, e);\n    }\n  };\n}\nfunction customSubmitImpl(options) {\n  const {\n    inst,\n    file,\n    data,\n    headers,\n    withCredentials,\n    action,\n    customRequest\n  } = options;\n  const {\n    doChange\n  } = options.inst;\n  let percentage = 0;\n  customRequest({\n    file,\n    data,\n    headers,\n    withCredentials,\n    action,\n    onProgress(event) {\n      const fileAfterChange = Object.assign({}, file, {\n        status: 'uploading'\n      });\n      const progress = event.percent;\n      fileAfterChange.percentage = progress;\n      percentage = progress;\n      doChange(fileAfterChange);\n    },\n    onFinish() {\n      var _a;\n      let fileAfterChange = Object.assign({}, file, {\n        status: 'finished',\n        percentage\n      });\n      fileAfterChange = createSettledFileInfo(((_a = inst.onFinish) === null || _a === void 0 ? void 0 : _a.call(inst, {\n        file: fileAfterChange\n      })) || fileAfterChange);\n      doChange(fileAfterChange);\n    },\n    onError() {\n      var _a;\n      let fileAfterChange = Object.assign({}, file, {\n        status: 'error',\n        percentage\n      });\n      fileAfterChange = createSettledFileInfo(((_a = inst.onError) === null || _a === void 0 ? void 0 : _a.call(inst, {\n        file: fileAfterChange\n      })) || fileAfterChange);\n      doChange(fileAfterChange);\n    }\n  });\n}\nfunction registerHandler(inst, file, request) {\n  const handlers = createXhrHandlers(inst, file, request);\n  request.onabort = handlers.handleXHRAbort;\n  request.onerror = handlers.handleXHRError;\n  request.onload = handlers.handleXHRLoad;\n  if (request.upload) {\n    request.upload.onprogress = handlers.handleXHRProgress;\n  }\n}\nfunction unwrapFunctionValue(data, file) {\n  if (typeof data === 'function') {\n    return data({\n      file\n    });\n  }\n  if (data) return data;\n  return {};\n}\nfunction setHeaders(request, headers, file) {\n  const headersObject = unwrapFunctionValue(headers, file);\n  if (!headersObject) return;\n  Object.keys(headersObject).forEach(key => {\n    request.setRequestHeader(key, headersObject[key]);\n  });\n}\nfunction appendData(formData, data, file) {\n  const dataObject = unwrapFunctionValue(data, file);\n  if (!dataObject) return;\n  Object.keys(dataObject).forEach(key => {\n    formData.append(key, dataObject[key]);\n  });\n}\nfunction submitImpl(inst, fieldName, file, {\n  method,\n  action,\n  withCredentials,\n  responseType,\n  headers,\n  data\n}) {\n  const request = new XMLHttpRequest();\n  request.responseType = responseType;\n  inst.xhrMap.set(file.id, request);\n  request.withCredentials = withCredentials;\n  const formData = new FormData();\n  appendData(formData, data, file);\n  if (file.file !== null) {\n    formData.append(fieldName, file.file);\n  }\n  registerHandler(inst, file, request);\n  if (action !== undefined) {\n    request.open(method.toUpperCase(), action);\n    setHeaders(request, headers, file);\n    request.send(formData);\n    const fileAfterChange = Object.assign({}, file, {\n      status: 'uploading'\n    });\n    inst.doChange(fileAfterChange);\n  }\n}\nexport const uploadProps = Object.assign(Object.assign({}, useTheme.props), {\n  name: {\n    type: String,\n    default: 'file'\n  },\n  accept: String,\n  action: String,\n  customRequest: Function,\n  directory: Boolean,\n  directoryDnd: {\n    type: Boolean,\n    default: undefined\n  },\n  method: {\n    type: String,\n    default: 'POST'\n  },\n  multiple: Boolean,\n  showFileList: {\n    type: Boolean,\n    default: true\n  },\n  data: [Object, Function],\n  headers: [Object, Function],\n  withCredentials: Boolean,\n  responseType: {\n    type: String,\n    default: ''\n  },\n  disabled: {\n    type: Boolean,\n    default: undefined\n  },\n  onChange: Function,\n  onRemove: Function,\n  onFinish: Function,\n  onError: Function,\n  onBeforeUpload: Function,\n  isErrorState: Function,\n  /** currently not used */\n  onDownload: Function,\n  defaultUpload: {\n    type: Boolean,\n    default: true\n  },\n  fileList: Array,\n  'onUpdate:fileList': [Function, Array],\n  onUpdateFileList: [Function, Array],\n  fileListClass: String,\n  fileListStyle: [String, Object],\n  defaultFileList: {\n    type: Array,\n    default: () => []\n  },\n  showCancelButton: {\n    type: Boolean,\n    default: true\n  },\n  showRemoveButton: {\n    type: Boolean,\n    default: true\n  },\n  showDownloadButton: Boolean,\n  showRetryButton: {\n    type: Boolean,\n    default: true\n  },\n  showPreviewButton: {\n    type: Boolean,\n    default: true\n  },\n  listType: {\n    type: String,\n    default: 'text'\n  },\n  onPreview: Function,\n  shouldUseThumbnailUrl: {\n    type: Function,\n    default: file => {\n      if (!environmentSupportFile) return false;\n      return isImageFile(file);\n    }\n  },\n  createThumbnailUrl: Function,\n  abstract: Boolean,\n  max: Number,\n  showTrigger: {\n    type: Boolean,\n    default: true\n  },\n  imageGroupProps: Object,\n  inputProps: Object,\n  triggerClass: String,\n  triggerStyle: [String, Object],\n  renderIcon: Function\n});\nexport default defineComponent({\n  name: 'Upload',\n  props: uploadProps,\n  setup(props) {\n    if (props.abstract && props.listType === 'image-card') {\n      throwError('upload', 'when the list-type is image-card, abstract is not supported.');\n    }\n    const {\n      mergedClsPrefixRef,\n      inlineThemeDisabled\n    } = useConfig(props);\n    const themeRef = useTheme('Upload', '-upload', style, uploadLight, props, mergedClsPrefixRef);\n    const formItem = useFormItem(props);\n    const maxReachedRef = computed(() => {\n      const {\n        max\n      } = props;\n      if (max !== undefined) {\n        return mergedFileListRef.value.length >= max;\n      }\n      return false;\n    });\n    const uncontrolledFileListRef = ref(props.defaultFileList);\n    const controlledFileListRef = toRef(props, 'fileList');\n    const inputElRef = ref(null);\n    const draggerInsideRef = {\n      value: false\n    };\n    const dragOverRef = ref(false);\n    const xhrMap = new Map();\n    const _mergedFileListRef = useMergedState(controlledFileListRef, uncontrolledFileListRef);\n    const mergedFileListRef = computed(() => _mergedFileListRef.value.map(createSettledFileInfo));\n    function openOpenFileDialog() {\n      var _a;\n      (_a = inputElRef.value) === null || _a === void 0 ? void 0 : _a.click();\n    }\n    function handleFileInputChange(e) {\n      const target = e.target;\n      handleFileAddition(target.files ? Array.from(target.files).map(file => ({\n        file,\n        entry: null,\n        source: 'input'\n      })) : null, e);\n      // May have bug! set to null?\n      target.value = '';\n    }\n    function doUpdateFileList(files) {\n      const {\n        'onUpdate:fileList': _onUpdateFileList,\n        onUpdateFileList\n      } = props;\n      if (_onUpdateFileList) call(_onUpdateFileList, files);\n      if (onUpdateFileList) call(onUpdateFileList, files);\n      uncontrolledFileListRef.value = files;\n    }\n    const mergedMultipleRef = computed(() => props.multiple || props.directory);\n    function handleFileAddition(fileAndEntries, e) {\n      if (!fileAndEntries || fileAndEntries.length === 0) return;\n      const {\n        onBeforeUpload\n      } = props;\n      fileAndEntries = mergedMultipleRef.value ? fileAndEntries : [fileAndEntries[0]];\n      const {\n        max,\n        accept\n      } = props;\n      fileAndEntries = fileAndEntries.filter(({\n        file,\n        source\n      }) => {\n        if (source === 'dnd' && (accept === null || accept === void 0 ? void 0 : accept.trim())) {\n          return matchType(file.name, file.type, accept);\n        } else {\n          return true;\n        }\n      });\n      if (max) {\n        fileAndEntries = fileAndEntries.slice(0, max - mergedFileListRef.value.length);\n      }\n      const batchId = createId();\n      void Promise.all(fileAndEntries.map(_a => __awaiter(this, [_a], void 0, function* ({\n        file,\n        entry\n      }) {\n        var _b;\n        const fileInfo = {\n          id: createId(),\n          batchId,\n          name: file.name,\n          status: 'pending',\n          percentage: 0,\n          file,\n          url: null,\n          type: file.type,\n          thumbnailUrl: null,\n          fullPath: (_b = entry === null || entry === void 0 ? void 0 : entry.fullPath) !== null && _b !== void 0 ? _b : `/${file.webkitRelativePath || file.name}`\n        };\n        if (!onBeforeUpload || (yield onBeforeUpload({\n          file: fileInfo,\n          fileList: mergedFileListRef.value\n        })) !== false) {\n          return fileInfo;\n        }\n        return null;\n      }))).then(fileInfos => __awaiter(this, void 0, void 0, function* () {\n        let nextTickChain = Promise.resolve();\n        fileInfos.forEach(fileInfo => {\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n          nextTickChain = nextTickChain.then(nextTick).then(() => {\n            fileInfo && doChange(fileInfo, e, {\n              append: true\n            });\n          });\n        });\n        yield nextTickChain;\n      })).then(() => {\n        if (props.defaultUpload) {\n          submit();\n        }\n      });\n    }\n    function submit(fileId) {\n      const {\n        method,\n        action,\n        withCredentials,\n        headers,\n        data,\n        name: fieldName\n      } = props;\n      const filesToUpload = fileId !== undefined ? mergedFileListRef.value.filter(file => file.id === fileId) : mergedFileListRef.value;\n      const shouldReupload = fileId !== undefined;\n      filesToUpload.forEach(file => {\n        const {\n          status\n        } = file;\n        if (status === 'pending' || status === 'error' && shouldReupload) {\n          if (props.customRequest) {\n            customSubmitImpl({\n              inst: {\n                doChange,\n                xhrMap,\n                onFinish: props.onFinish,\n                onError: props.onError\n              },\n              file,\n              action,\n              withCredentials,\n              headers,\n              data,\n              customRequest: props.customRequest\n            });\n          } else {\n            submitImpl({\n              doChange,\n              xhrMap,\n              onFinish: props.onFinish,\n              onError: props.onError,\n              isErrorState: props.isErrorState\n            }, fieldName, file, {\n              method,\n              action,\n              withCredentials,\n              responseType: props.responseType,\n              headers,\n              data\n            });\n          }\n        }\n      });\n    }\n    const doChange = (fileAfterChange, event, options = {\n      append: false,\n      remove: false\n    }) => {\n      const {\n        append,\n        remove\n      } = options;\n      const fileListAfterChange = Array.from(mergedFileListRef.value);\n      const fileIndex = fileListAfterChange.findIndex(file => file.id === fileAfterChange.id);\n      if (append || remove || ~fileIndex) {\n        if (append) {\n          fileListAfterChange.push(fileAfterChange);\n        } else if (remove) {\n          fileListAfterChange.splice(fileIndex, 1);\n        } else {\n          fileListAfterChange.splice(fileIndex, 1, fileAfterChange);\n        }\n        const {\n          onChange\n        } = props;\n        if (onChange) {\n          onChange({\n            file: fileAfterChange,\n            fileList: fileListAfterChange,\n            event\n          });\n        }\n        doUpdateFileList(fileListAfterChange);\n      } else if (process.env.NODE_ENV !== 'production') {\n        warn('upload', 'File has no corresponding id in current file list.');\n      }\n    };\n    function getFileThumbnailUrlResolver(file) {\n      var _a;\n      if (file.thumbnailUrl) return file.thumbnailUrl;\n      const {\n        createThumbnailUrl\n      } = props;\n      if (createThumbnailUrl) {\n        return (_a = createThumbnailUrl(file.file, file)) !== null && _a !== void 0 ? _a : file.url || '';\n      }\n      if (file.url) {\n        return file.url;\n      } else if (file.file) {\n        return createImageDataUrl(file.file);\n      }\n      return '';\n    }\n    const cssVarsRef = computed(() => {\n      const {\n        common: {\n          cubicBezierEaseInOut\n        },\n        self: {\n          draggerColor,\n          draggerBorder,\n          draggerBorderHover,\n          itemColorHover,\n          itemColorHoverError,\n          itemTextColorError,\n          itemTextColorSuccess,\n          itemTextColor,\n          itemIconColor,\n          itemDisabledOpacity,\n          lineHeight,\n          borderRadius,\n          fontSize,\n          itemBorderImageCardError,\n          itemBorderImageCard\n        }\n      } = themeRef.value;\n      return {\n        '--n-bezier': cubicBezierEaseInOut,\n        '--n-border-radius': borderRadius,\n        '--n-dragger-border': draggerBorder,\n        '--n-dragger-border-hover': draggerBorderHover,\n        '--n-dragger-color': draggerColor,\n        '--n-font-size': fontSize,\n        '--n-item-color-hover': itemColorHover,\n        '--n-item-color-hover-error': itemColorHoverError,\n        '--n-item-disabled-opacity': itemDisabledOpacity,\n        '--n-item-icon-color': itemIconColor,\n        '--n-item-text-color': itemTextColor,\n        '--n-item-text-color-error': itemTextColorError,\n        '--n-item-text-color-success': itemTextColorSuccess,\n        '--n-line-height': lineHeight,\n        '--n-item-border-image-card-error': itemBorderImageCardError,\n        '--n-item-border-image-card': itemBorderImageCard\n      };\n    });\n    const themeClassHandle = inlineThemeDisabled ? useThemeClass('upload', undefined, cssVarsRef, props) : undefined;\n    provide(uploadInjectionKey, {\n      mergedClsPrefixRef,\n      mergedThemeRef: themeRef,\n      showCancelButtonRef: toRef(props, 'showCancelButton'),\n      showDownloadButtonRef: toRef(props, 'showDownloadButton'),\n      showRemoveButtonRef: toRef(props, 'showRemoveButton'),\n      showRetryButtonRef: toRef(props, 'showRetryButton'),\n      onRemoveRef: toRef(props, 'onRemove'),\n      onDownloadRef: toRef(props, 'onDownload'),\n      mergedFileListRef,\n      triggerClassRef: toRef(props, 'triggerClass'),\n      triggerStyleRef: toRef(props, 'triggerStyle'),\n      shouldUseThumbnailUrlRef: toRef(props, 'shouldUseThumbnailUrl'),\n      renderIconRef: toRef(props, 'renderIcon'),\n      xhrMap,\n      submit,\n      doChange,\n      showPreviewButtonRef: toRef(props, 'showPreviewButton'),\n      onPreviewRef: toRef(props, 'onPreview'),\n      getFileThumbnailUrlResolver,\n      listTypeRef: toRef(props, 'listType'),\n      dragOverRef,\n      openOpenFileDialog,\n      draggerInsideRef,\n      handleFileAddition,\n      mergedDisabledRef: formItem.mergedDisabledRef,\n      maxReachedRef,\n      fileListClassRef: toRef(props, 'fileListClass'),\n      fileListStyleRef: toRef(props, 'fileListStyle'),\n      abstractRef: toRef(props, 'abstract'),\n      acceptRef: toRef(props, 'accept'),\n      cssVarsRef: inlineThemeDisabled ? undefined : cssVarsRef,\n      themeClassRef: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass,\n      onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender,\n      showTriggerRef: toRef(props, 'showTrigger'),\n      imageGroupPropsRef: toRef(props, 'imageGroupProps'),\n      mergedDirectoryDndRef: computed(() => {\n        var _a;\n        return (_a = props.directoryDnd) !== null && _a !== void 0 ? _a : props.directory;\n      })\n    });\n    const exposedMethods = {\n      clear: () => {\n        uncontrolledFileListRef.value = [];\n      },\n      submit,\n      openOpenFileDialog\n    };\n    return Object.assign({\n      mergedClsPrefix: mergedClsPrefixRef,\n      draggerInsideRef,\n      inputElRef,\n      mergedTheme: themeRef,\n      dragOver: dragOverRef,\n      mergedMultiple: mergedMultipleRef,\n      cssVars: inlineThemeDisabled ? undefined : cssVarsRef,\n      themeClass: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass,\n      onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender,\n      handleFileInputChange\n    }, exposedMethods);\n  },\n  render() {\n    var _a, _b;\n    const {\n      draggerInsideRef,\n      mergedClsPrefix,\n      $slots,\n      directory,\n      onRender\n    } = this;\n    if ($slots.default && !this.abstract) {\n      const firstChild = $slots.default()[0];\n      if ((_a = firstChild === null || firstChild === void 0 ? void 0 : firstChild.type) === null || _a === void 0 ? void 0 : _a[uploadDraggerKey]) {\n        draggerInsideRef.value = true;\n      }\n    }\n    const inputNode = h(\"input\", Object.assign({}, this.inputProps, {\n      ref: \"inputElRef\",\n      type: \"file\",\n      class: `${mergedClsPrefix}-upload-file-input`,\n      accept: this.accept,\n      multiple: this.mergedMultiple,\n      onChange: this.handleFileInputChange,\n      // @ts-expect-error // seems vue-tsc will add the prop, so we can't use expect-error\n      webkitdirectory: directory || undefined,\n      directory: directory || undefined\n    }));\n    if (this.abstract) {\n      return h(Fragment, null, (_b = $slots.default) === null || _b === void 0 ? void 0 : _b.call($slots), h(Teleport, {\n        to: \"body\"\n      }, inputNode));\n    }\n    onRender === null || onRender === void 0 ? void 0 : onRender();\n    return h(\"div\", {\n      class: [`${mergedClsPrefix}-upload`, draggerInsideRef.value && `${mergedClsPrefix}-upload--dragger-inside`, this.dragOver && `${mergedClsPrefix}-upload--drag-over`, this.themeClass],\n      style: this.cssVars\n    }, inputNode, this.showTrigger && this.listType !== 'image-card' && h(NUploadTrigger, null, $slots), this.showFileList && h(NUploadFileList, null, $slots));\n  }\n});","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","h","defineComponent","computed","provide","toRef","ref","Fragment","Teleport","nextTick","createId","useMergedState","useConfig","useTheme","useFormItem","useThemeClass","warn","call","throwError","uploadLight","uploadDraggerKey","uploadInjectionKey","createImageDataUrl","createSettledFileInfo","environmentSupportFile","isImageFile","matchType","NUploadTrigger","NUploadFileList","style","createXhrHandlers","inst","file","xhr","doChange","xhrMap","percentage","handleXHRError","_a","fileAfterChange","Object","assign","status","delete","id","onError","event","handleXHRLoad","isErrorState","onFinish","handleXHRAbort","handleXHRProgress","lengthComputable","progress","Math","ceil","loaded","total","customSubmitImpl","options","data","headers","withCredentials","action","customRequest","onProgress","percent","registerHandler","request","handlers","onabort","onerror","onload","upload","onprogress","unwrapFunctionValue","setHeaders","headersObject","keys","forEach","key","setRequestHeader","appendData","formData","dataObject","append","submitImpl","fieldName","method","responseType","XMLHttpRequest","set","FormData","undefined","open","toUpperCase","send","uploadProps","props","name","type","String","default","accept","Function","directory","Boolean","directoryDnd","multiple","showFileList","disabled","onChange","onRemove","onBeforeUpload","onDownload","defaultUpload","fileList","Array","onUpdateFileList","fileListClass","fileListStyle","defaultFileList","showCancelButton","showRemoveButton","showDownloadButton","showRetryButton","showPreviewButton","listType","onPreview","shouldUseThumbnailUrl","createThumbnailUrl","abstract","max","Number","showTrigger","imageGroupProps","inputProps","triggerClass","triggerStyle","renderIcon","setup","mergedClsPrefixRef","inlineThemeDisabled","themeRef","formItem","maxReachedRef","mergedFileListRef","length","uncontrolledFileListRef","controlledFileListRef","inputElRef","draggerInsideRef","dragOverRef","Map","_mergedFileListRef","map","openOpenFileDialog","click","handleFileInputChange","target","handleFileAddition","files","from","entry","source","doUpdateFileList","_onUpdateFileList","mergedMultipleRef","fileAndEntries","filter","trim","slice","batchId","all","_b","fileInfo","url","thumbnailUrl","fullPath","webkitRelativePath","fileInfos","nextTickChain","submit","fileId","filesToUpload","shouldReupload","remove","fileListAfterChange","fileIndex","findIndex","push","splice","process","env","NODE_ENV","getFileThumbnailUrlResolver","cssVarsRef","common","cubicBezierEaseInOut","self","draggerColor","draggerBorder","draggerBorderHover","itemColorHover","itemColorHoverError","itemTextColorError","itemTextColorSuccess","itemTextColor","itemIconColor","itemDisabledOpacity","lineHeight","borderRadius","fontSize","itemBorderImageCardError","itemBorderImageCard","themeClassHandle","mergedThemeRef","showCancelButtonRef","showDownloadButtonRef","showRemoveButtonRef","showRetryButtonRef","onRemoveRef","onDownloadRef","triggerClassRef","triggerStyleRef","shouldUseThumbnailUrlRef","renderIconRef","showPreviewButtonRef","onPreviewRef","listTypeRef","mergedDisabledRef","fileListClassRef","fileListStyleRef","abstractRef","acceptRef","themeClassRef","themeClass","onRender","showTriggerRef","imageGroupPropsRef","mergedDirectoryDndRef","exposedMethods","clear","mergedClsPrefix","mergedTheme","dragOver","mergedMultiple","cssVars","render","$slots","firstChild","inputNode","class","webkitdirectory","to"],"sources":["/Users/wangjohnson/ai_marketing/frontend/node_modules/naive-ui/es/upload/src/Upload.mjs"],"sourcesContent":["var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nimport { h, defineComponent, computed, provide, toRef, ref, Fragment, Teleport, nextTick } from 'vue';\nimport { createId } from 'seemly';\nimport { useMergedState } from 'vooks';\nimport { useConfig, useTheme, useFormItem, useThemeClass } from \"../../_mixins/index.mjs\";\nimport { warn, call, throwError } from \"../../_utils/index.mjs\";\nimport { uploadLight } from \"../styles/index.mjs\";\nimport { uploadDraggerKey } from \"./UploadDragger.mjs\";\nimport { uploadInjectionKey } from \"./interface.mjs\";\nimport { createImageDataUrl, createSettledFileInfo, environmentSupportFile, isImageFile, matchType } from \"./utils.mjs\";\nimport NUploadTrigger from \"./UploadTrigger.mjs\";\nimport NUploadFileList from \"./UploadFileList.mjs\";\nimport style from \"./styles/index.cssr.mjs\";\n/**\n * fils status ['pending', 'uploading', 'finished', 'removed', 'error']\n */\nfunction createXhrHandlers(inst, file, xhr) {\n  const {\n    doChange,\n    xhrMap\n  } = inst;\n  let percentage = 0;\n  function handleXHRError(e) {\n    var _a;\n    let fileAfterChange = Object.assign({}, file, {\n      status: 'error',\n      percentage\n    });\n    xhrMap.delete(file.id);\n    fileAfterChange = createSettledFileInfo(((_a = inst.onError) === null || _a === void 0 ? void 0 : _a.call(inst, {\n      file: fileAfterChange,\n      event: e\n    })) || fileAfterChange);\n    doChange(fileAfterChange, e);\n  }\n  function handleXHRLoad(e) {\n    var _a;\n    if (inst.isErrorState) {\n      if (inst.isErrorState(xhr)) {\n        handleXHRError(e);\n        return;\n      }\n    } else {\n      if (xhr.status < 200 || xhr.status >= 300) {\n        handleXHRError(e);\n        return;\n      }\n    }\n    let fileAfterChange = Object.assign({}, file, {\n      status: 'finished',\n      percentage\n    });\n    xhrMap.delete(file.id);\n    fileAfterChange = createSettledFileInfo(((_a = inst.onFinish) === null || _a === void 0 ? void 0 : _a.call(inst, {\n      file: fileAfterChange,\n      event: e\n    })) || fileAfterChange);\n    doChange(fileAfterChange, e);\n  }\n  return {\n    handleXHRLoad,\n    handleXHRError,\n    handleXHRAbort(e) {\n      const fileAfterChange = Object.assign({}, file, {\n        status: 'removed',\n        file: null,\n        percentage\n      });\n      xhrMap.delete(file.id);\n      doChange(fileAfterChange, e);\n    },\n    handleXHRProgress(e) {\n      const fileAfterChange = Object.assign({}, file, {\n        status: 'uploading'\n      });\n      if (e.lengthComputable) {\n        const progress = Math.ceil(e.loaded / e.total * 100);\n        fileAfterChange.percentage = progress;\n        percentage = progress;\n      }\n      doChange(fileAfterChange, e);\n    }\n  };\n}\nfunction customSubmitImpl(options) {\n  const {\n    inst,\n    file,\n    data,\n    headers,\n    withCredentials,\n    action,\n    customRequest\n  } = options;\n  const {\n    doChange\n  } = options.inst;\n  let percentage = 0;\n  customRequest({\n    file,\n    data,\n    headers,\n    withCredentials,\n    action,\n    onProgress(event) {\n      const fileAfterChange = Object.assign({}, file, {\n        status: 'uploading'\n      });\n      const progress = event.percent;\n      fileAfterChange.percentage = progress;\n      percentage = progress;\n      doChange(fileAfterChange);\n    },\n    onFinish() {\n      var _a;\n      let fileAfterChange = Object.assign({}, file, {\n        status: 'finished',\n        percentage\n      });\n      fileAfterChange = createSettledFileInfo(((_a = inst.onFinish) === null || _a === void 0 ? void 0 : _a.call(inst, {\n        file: fileAfterChange\n      })) || fileAfterChange);\n      doChange(fileAfterChange);\n    },\n    onError() {\n      var _a;\n      let fileAfterChange = Object.assign({}, file, {\n        status: 'error',\n        percentage\n      });\n      fileAfterChange = createSettledFileInfo(((_a = inst.onError) === null || _a === void 0 ? void 0 : _a.call(inst, {\n        file: fileAfterChange\n      })) || fileAfterChange);\n      doChange(fileAfterChange);\n    }\n  });\n}\nfunction registerHandler(inst, file, request) {\n  const handlers = createXhrHandlers(inst, file, request);\n  request.onabort = handlers.handleXHRAbort;\n  request.onerror = handlers.handleXHRError;\n  request.onload = handlers.handleXHRLoad;\n  if (request.upload) {\n    request.upload.onprogress = handlers.handleXHRProgress;\n  }\n}\nfunction unwrapFunctionValue(data, file) {\n  if (typeof data === 'function') {\n    return data({\n      file\n    });\n  }\n  if (data) return data;\n  return {};\n}\nfunction setHeaders(request, headers, file) {\n  const headersObject = unwrapFunctionValue(headers, file);\n  if (!headersObject) return;\n  Object.keys(headersObject).forEach(key => {\n    request.setRequestHeader(key, headersObject[key]);\n  });\n}\nfunction appendData(formData, data, file) {\n  const dataObject = unwrapFunctionValue(data, file);\n  if (!dataObject) return;\n  Object.keys(dataObject).forEach(key => {\n    formData.append(key, dataObject[key]);\n  });\n}\nfunction submitImpl(inst, fieldName, file, {\n  method,\n  action,\n  withCredentials,\n  responseType,\n  headers,\n  data\n}) {\n  const request = new XMLHttpRequest();\n  request.responseType = responseType;\n  inst.xhrMap.set(file.id, request);\n  request.withCredentials = withCredentials;\n  const formData = new FormData();\n  appendData(formData, data, file);\n  if (file.file !== null) {\n    formData.append(fieldName, file.file);\n  }\n  registerHandler(inst, file, request);\n  if (action !== undefined) {\n    request.open(method.toUpperCase(), action);\n    setHeaders(request, headers, file);\n    request.send(formData);\n    const fileAfterChange = Object.assign({}, file, {\n      status: 'uploading'\n    });\n    inst.doChange(fileAfterChange);\n  }\n}\nexport const uploadProps = Object.assign(Object.assign({}, useTheme.props), {\n  name: {\n    type: String,\n    default: 'file'\n  },\n  accept: String,\n  action: String,\n  customRequest: Function,\n  directory: Boolean,\n  directoryDnd: {\n    type: Boolean,\n    default: undefined\n  },\n  method: {\n    type: String,\n    default: 'POST'\n  },\n  multiple: Boolean,\n  showFileList: {\n    type: Boolean,\n    default: true\n  },\n  data: [Object, Function],\n  headers: [Object, Function],\n  withCredentials: Boolean,\n  responseType: {\n    type: String,\n    default: ''\n  },\n  disabled: {\n    type: Boolean,\n    default: undefined\n  },\n  onChange: Function,\n  onRemove: Function,\n  onFinish: Function,\n  onError: Function,\n  onBeforeUpload: Function,\n  isErrorState: Function,\n  /** currently not used */\n  onDownload: Function,\n  defaultUpload: {\n    type: Boolean,\n    default: true\n  },\n  fileList: Array,\n  'onUpdate:fileList': [Function, Array],\n  onUpdateFileList: [Function, Array],\n  fileListClass: String,\n  fileListStyle: [String, Object],\n  defaultFileList: {\n    type: Array,\n    default: () => []\n  },\n  showCancelButton: {\n    type: Boolean,\n    default: true\n  },\n  showRemoveButton: {\n    type: Boolean,\n    default: true\n  },\n  showDownloadButton: Boolean,\n  showRetryButton: {\n    type: Boolean,\n    default: true\n  },\n  showPreviewButton: {\n    type: Boolean,\n    default: true\n  },\n  listType: {\n    type: String,\n    default: 'text'\n  },\n  onPreview: Function,\n  shouldUseThumbnailUrl: {\n    type: Function,\n    default: file => {\n      if (!environmentSupportFile) return false;\n      return isImageFile(file);\n    }\n  },\n  createThumbnailUrl: Function,\n  abstract: Boolean,\n  max: Number,\n  showTrigger: {\n    type: Boolean,\n    default: true\n  },\n  imageGroupProps: Object,\n  inputProps: Object,\n  triggerClass: String,\n  triggerStyle: [String, Object],\n  renderIcon: Function\n});\nexport default defineComponent({\n  name: 'Upload',\n  props: uploadProps,\n  setup(props) {\n    if (props.abstract && props.listType === 'image-card') {\n      throwError('upload', 'when the list-type is image-card, abstract is not supported.');\n    }\n    const {\n      mergedClsPrefixRef,\n      inlineThemeDisabled\n    } = useConfig(props);\n    const themeRef = useTheme('Upload', '-upload', style, uploadLight, props, mergedClsPrefixRef);\n    const formItem = useFormItem(props);\n    const maxReachedRef = computed(() => {\n      const {\n        max\n      } = props;\n      if (max !== undefined) {\n        return mergedFileListRef.value.length >= max;\n      }\n      return false;\n    });\n    const uncontrolledFileListRef = ref(props.defaultFileList);\n    const controlledFileListRef = toRef(props, 'fileList');\n    const inputElRef = ref(null);\n    const draggerInsideRef = {\n      value: false\n    };\n    const dragOverRef = ref(false);\n    const xhrMap = new Map();\n    const _mergedFileListRef = useMergedState(controlledFileListRef, uncontrolledFileListRef);\n    const mergedFileListRef = computed(() => _mergedFileListRef.value.map(createSettledFileInfo));\n    function openOpenFileDialog() {\n      var _a;\n      (_a = inputElRef.value) === null || _a === void 0 ? void 0 : _a.click();\n    }\n    function handleFileInputChange(e) {\n      const target = e.target;\n      handleFileAddition(target.files ? Array.from(target.files).map(file => ({\n        file,\n        entry: null,\n        source: 'input'\n      })) : null, e);\n      // May have bug! set to null?\n      target.value = '';\n    }\n    function doUpdateFileList(files) {\n      const {\n        'onUpdate:fileList': _onUpdateFileList,\n        onUpdateFileList\n      } = props;\n      if (_onUpdateFileList) call(_onUpdateFileList, files);\n      if (onUpdateFileList) call(onUpdateFileList, files);\n      uncontrolledFileListRef.value = files;\n    }\n    const mergedMultipleRef = computed(() => props.multiple || props.directory);\n    function handleFileAddition(fileAndEntries, e) {\n      if (!fileAndEntries || fileAndEntries.length === 0) return;\n      const {\n        onBeforeUpload\n      } = props;\n      fileAndEntries = mergedMultipleRef.value ? fileAndEntries : [fileAndEntries[0]];\n      const {\n        max,\n        accept\n      } = props;\n      fileAndEntries = fileAndEntries.filter(({\n        file,\n        source\n      }) => {\n        if (source === 'dnd' && (accept === null || accept === void 0 ? void 0 : accept.trim())) {\n          return matchType(file.name, file.type, accept);\n        } else {\n          return true;\n        }\n      });\n      if (max) {\n        fileAndEntries = fileAndEntries.slice(0, max - mergedFileListRef.value.length);\n      }\n      const batchId = createId();\n      void Promise.all(fileAndEntries.map(_a => __awaiter(this, [_a], void 0, function* ({\n        file,\n        entry\n      }) {\n        var _b;\n        const fileInfo = {\n          id: createId(),\n          batchId,\n          name: file.name,\n          status: 'pending',\n          percentage: 0,\n          file,\n          url: null,\n          type: file.type,\n          thumbnailUrl: null,\n          fullPath: (_b = entry === null || entry === void 0 ? void 0 : entry.fullPath) !== null && _b !== void 0 ? _b : `/${file.webkitRelativePath || file.name}`\n        };\n        if (!onBeforeUpload || (yield onBeforeUpload({\n          file: fileInfo,\n          fileList: mergedFileListRef.value\n        })) !== false) {\n          return fileInfo;\n        }\n        return null;\n      }))).then(fileInfos => __awaiter(this, void 0, void 0, function* () {\n        let nextTickChain = Promise.resolve();\n        fileInfos.forEach(fileInfo => {\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n          nextTickChain = nextTickChain.then(nextTick).then(() => {\n            fileInfo && doChange(fileInfo, e, {\n              append: true\n            });\n          });\n        });\n        yield nextTickChain;\n      })).then(() => {\n        if (props.defaultUpload) {\n          submit();\n        }\n      });\n    }\n    function submit(fileId) {\n      const {\n        method,\n        action,\n        withCredentials,\n        headers,\n        data,\n        name: fieldName\n      } = props;\n      const filesToUpload = fileId !== undefined ? mergedFileListRef.value.filter(file => file.id === fileId) : mergedFileListRef.value;\n      const shouldReupload = fileId !== undefined;\n      filesToUpload.forEach(file => {\n        const {\n          status\n        } = file;\n        if (status === 'pending' || status === 'error' && shouldReupload) {\n          if (props.customRequest) {\n            customSubmitImpl({\n              inst: {\n                doChange,\n                xhrMap,\n                onFinish: props.onFinish,\n                onError: props.onError\n              },\n              file,\n              action,\n              withCredentials,\n              headers,\n              data,\n              customRequest: props.customRequest\n            });\n          } else {\n            submitImpl({\n              doChange,\n              xhrMap,\n              onFinish: props.onFinish,\n              onError: props.onError,\n              isErrorState: props.isErrorState\n            }, fieldName, file, {\n              method,\n              action,\n              withCredentials,\n              responseType: props.responseType,\n              headers,\n              data\n            });\n          }\n        }\n      });\n    }\n    const doChange = (fileAfterChange, event, options = {\n      append: false,\n      remove: false\n    }) => {\n      const {\n        append,\n        remove\n      } = options;\n      const fileListAfterChange = Array.from(mergedFileListRef.value);\n      const fileIndex = fileListAfterChange.findIndex(file => file.id === fileAfterChange.id);\n      if (append || remove || ~fileIndex) {\n        if (append) {\n          fileListAfterChange.push(fileAfterChange);\n        } else if (remove) {\n          fileListAfterChange.splice(fileIndex, 1);\n        } else {\n          fileListAfterChange.splice(fileIndex, 1, fileAfterChange);\n        }\n        const {\n          onChange\n        } = props;\n        if (onChange) {\n          onChange({\n            file: fileAfterChange,\n            fileList: fileListAfterChange,\n            event\n          });\n        }\n        doUpdateFileList(fileListAfterChange);\n      } else if (process.env.NODE_ENV !== 'production') {\n        warn('upload', 'File has no corresponding id in current file list.');\n      }\n    };\n    function getFileThumbnailUrlResolver(file) {\n      var _a;\n      if (file.thumbnailUrl) return file.thumbnailUrl;\n      const {\n        createThumbnailUrl\n      } = props;\n      if (createThumbnailUrl) {\n        return (_a = createThumbnailUrl(file.file, file)) !== null && _a !== void 0 ? _a : file.url || '';\n      }\n      if (file.url) {\n        return file.url;\n      } else if (file.file) {\n        return createImageDataUrl(file.file);\n      }\n      return '';\n    }\n    const cssVarsRef = computed(() => {\n      const {\n        common: {\n          cubicBezierEaseInOut\n        },\n        self: {\n          draggerColor,\n          draggerBorder,\n          draggerBorderHover,\n          itemColorHover,\n          itemColorHoverError,\n          itemTextColorError,\n          itemTextColorSuccess,\n          itemTextColor,\n          itemIconColor,\n          itemDisabledOpacity,\n          lineHeight,\n          borderRadius,\n          fontSize,\n          itemBorderImageCardError,\n          itemBorderImageCard\n        }\n      } = themeRef.value;\n      return {\n        '--n-bezier': cubicBezierEaseInOut,\n        '--n-border-radius': borderRadius,\n        '--n-dragger-border': draggerBorder,\n        '--n-dragger-border-hover': draggerBorderHover,\n        '--n-dragger-color': draggerColor,\n        '--n-font-size': fontSize,\n        '--n-item-color-hover': itemColorHover,\n        '--n-item-color-hover-error': itemColorHoverError,\n        '--n-item-disabled-opacity': itemDisabledOpacity,\n        '--n-item-icon-color': itemIconColor,\n        '--n-item-text-color': itemTextColor,\n        '--n-item-text-color-error': itemTextColorError,\n        '--n-item-text-color-success': itemTextColorSuccess,\n        '--n-line-height': lineHeight,\n        '--n-item-border-image-card-error': itemBorderImageCardError,\n        '--n-item-border-image-card': itemBorderImageCard\n      };\n    });\n    const themeClassHandle = inlineThemeDisabled ? useThemeClass('upload', undefined, cssVarsRef, props) : undefined;\n    provide(uploadInjectionKey, {\n      mergedClsPrefixRef,\n      mergedThemeRef: themeRef,\n      showCancelButtonRef: toRef(props, 'showCancelButton'),\n      showDownloadButtonRef: toRef(props, 'showDownloadButton'),\n      showRemoveButtonRef: toRef(props, 'showRemoveButton'),\n      showRetryButtonRef: toRef(props, 'showRetryButton'),\n      onRemoveRef: toRef(props, 'onRemove'),\n      onDownloadRef: toRef(props, 'onDownload'),\n      mergedFileListRef,\n      triggerClassRef: toRef(props, 'triggerClass'),\n      triggerStyleRef: toRef(props, 'triggerStyle'),\n      shouldUseThumbnailUrlRef: toRef(props, 'shouldUseThumbnailUrl'),\n      renderIconRef: toRef(props, 'renderIcon'),\n      xhrMap,\n      submit,\n      doChange,\n      showPreviewButtonRef: toRef(props, 'showPreviewButton'),\n      onPreviewRef: toRef(props, 'onPreview'),\n      getFileThumbnailUrlResolver,\n      listTypeRef: toRef(props, 'listType'),\n      dragOverRef,\n      openOpenFileDialog,\n      draggerInsideRef,\n      handleFileAddition,\n      mergedDisabledRef: formItem.mergedDisabledRef,\n      maxReachedRef,\n      fileListClassRef: toRef(props, 'fileListClass'),\n      fileListStyleRef: toRef(props, 'fileListStyle'),\n      abstractRef: toRef(props, 'abstract'),\n      acceptRef: toRef(props, 'accept'),\n      cssVarsRef: inlineThemeDisabled ? undefined : cssVarsRef,\n      themeClassRef: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass,\n      onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender,\n      showTriggerRef: toRef(props, 'showTrigger'),\n      imageGroupPropsRef: toRef(props, 'imageGroupProps'),\n      mergedDirectoryDndRef: computed(() => {\n        var _a;\n        return (_a = props.directoryDnd) !== null && _a !== void 0 ? _a : props.directory;\n      })\n    });\n    const exposedMethods = {\n      clear: () => {\n        uncontrolledFileListRef.value = [];\n      },\n      submit,\n      openOpenFileDialog\n    };\n    return Object.assign({\n      mergedClsPrefix: mergedClsPrefixRef,\n      draggerInsideRef,\n      inputElRef,\n      mergedTheme: themeRef,\n      dragOver: dragOverRef,\n      mergedMultiple: mergedMultipleRef,\n      cssVars: inlineThemeDisabled ? undefined : cssVarsRef,\n      themeClass: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.themeClass,\n      onRender: themeClassHandle === null || themeClassHandle === void 0 ? void 0 : themeClassHandle.onRender,\n      handleFileInputChange\n    }, exposedMethods);\n  },\n  render() {\n    var _a, _b;\n    const {\n      draggerInsideRef,\n      mergedClsPrefix,\n      $slots,\n      directory,\n      onRender\n    } = this;\n    if ($slots.default && !this.abstract) {\n      const firstChild = $slots.default()[0];\n      if ((_a = firstChild === null || firstChild === void 0 ? void 0 : firstChild.type) === null || _a === void 0 ? void 0 : _a[uploadDraggerKey]) {\n        draggerInsideRef.value = true;\n      }\n    }\n    const inputNode = h(\"input\", Object.assign({}, this.inputProps, {\n      ref: \"inputElRef\",\n      type: \"file\",\n      class: `${mergedClsPrefix}-upload-file-input`,\n      accept: this.accept,\n      multiple: this.mergedMultiple,\n      onChange: this.handleFileInputChange,\n      // @ts-expect-error // seems vue-tsc will add the prop, so we can't use expect-error\n      webkitdirectory: directory || undefined,\n      directory: directory || undefined\n    }));\n    if (this.abstract) {\n      return h(Fragment, null, (_b = $slots.default) === null || _b === void 0 ? void 0 : _b.call($slots), h(Teleport, {\n        to: \"body\"\n      }, inputNode));\n    }\n    onRender === null || onRender === void 0 ? void 0 : onRender();\n    return h(\"div\", {\n      class: [`${mergedClsPrefix}-upload`, draggerInsideRef.value && `${mergedClsPrefix}-upload--dragger-inside`, this.dragOver && `${mergedClsPrefix}-upload--drag-over`, this.themeClass],\n      style: this.cssVars\n    }, inputNode, this.showTrigger && this.listType !== 'image-card' && h(NUploadTrigger, null, $slots), this.showFileList && h(NUploadFileList, null, $slots));\n  }\n});"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}